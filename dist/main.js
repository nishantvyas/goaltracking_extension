(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))n(o);new MutationObserver(o=>{for(const s of o)if(s.type==="childList")for(const c of s.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&n(c)}).observe(document,{childList:!0,subtree:!0});function a(o){const s={};return o.integrity&&(s.integrity=o.integrity),o.referrerPolicy&&(s.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?s.credentials="include":o.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function n(o){if(o.ep)return;o.ep=!0;const s=a(o);fetch(o.href,s)}})();function O(t,e){const a=t.getTime()-e.getTime();return Math.ceil(a/(1e3*60*60*24))}function Y(t,e){const a=t.getTime()-e.getTime();return Math.floor(a/(1e3*60*60))}function j(t,e){const a=t.getTime()-e.getTime();return Math.floor(a/(1e3*60))}function q(t,e){const a=t.getTime()-e.getTime();return Math.floor(a/1e3)}let r={goal:"",targetDate:null,goalCreatedAt:null,tasks:[],doneTasks:[]};const i={countdown:document.getElementById("countdown"),days:document.getElementById("days"),hours:document.getElementById("hours"),minutes:document.getElementById("minutes"),seconds:document.getElementById("seconds"),goalTitle:document.getElementById("goalTitle"),addTaskBtn:document.getElementById("addTaskBtn"),todoList:document.getElementById("todoList"),doneList:document.getElementById("doneList"),settingsBtn:document.getElementById("settingsBtn"),settingsModal:document.getElementById("settingsModal"),taskModal:document.getElementById("taskModal"),taskInput:document.getElementById("taskInput"),taskDescription:document.getElementById("taskDescription"),saveTaskBtn:document.getElementById("saveTaskBtn"),deleteTaskBtn:document.getElementById("deleteTaskBtn"),closeTaskBtn:document.getElementById("closeTaskBtn"),goalInput:document.getElementById("goalInput"),dateInput:document.getElementById("dateInput"),saveSettingsBtn:document.getElementById("saveSettingsBtn"),closeSettingsBtn:document.getElementById("closeSettingsBtn"),listsContainer:document.querySelector(".lists-container"),prevList:document.getElementById("prevList"),nextList:document.getElementById("nextList"),activityMatrix:document.getElementById("activityMatrix"),activityStats:document.getElementById("activityStats"),activityTooltip:document.getElementById("activityTooltip")};let p=null,v=null;async function K(){await z(),W(),D(),it(),Q()}function W(){let t=!1;r.doneTasks.forEach(e=>{e.completedAt&&!e.timestampMigrated&&(e.timestampMigrated=!0,t=!0)}),r.tasks.forEach(e=>{(e.createdAt||e.updatedAt)&&!e.timestampMigrated&&(e.timestampMigrated=!0,t=!0)}),t&&(console.log("Marked tasks as migrated to new timezone handling"),f())}function _(){if(!Array.isArray(r.doneTasks)||r.doneTasks.length<=1e3)return;const t=new Date,e=new Date(t.getTime()-90*24*60*60*1e3),n=[...r.doneTasks].sort((d,l)=>new Date(l.completedAt||l.updatedAt||l.createdAt)-new Date(d.completedAt||d.updatedAt||d.createdAt)).slice(0,1e3),o=new Set(n.map(d=>d.id)),s=r.doneTasks.filter(d=>o.has(d.id)?!1:new Date(d.completedAt||d.updatedAt||d.createdAt)>=e),c=[...n,...s];if(c.length<r.doneTasks.length){const d=r.doneTasks.length-c.length;console.log(`Cleaned up ${d} old completed tasks`),r.doneTasks=c,f()}}async function z(){try{const t=await chrome.storage.local.get(["goalState","tasks","doneTasks"]);if(t.goalState){const e=JSON.parse(t.goalState);r={goal:e.goal||"",targetDate:e.targetDate?new Date(e.targetDate):null,goalCreatedAt:e.goalCreatedAt?new Date(e.goalCreatedAt):null,tasks:t.tasks?JSON.parse(t.tasks):[],doneTasks:t.doneTasks?JSON.parse(t.doneTasks):[]}}else{const e=await chrome.storage.sync.get(["goalState","tasks","doneTasks"]);if(e.goalState){const a=JSON.parse(e.goalState);r={goal:a.goal||"",targetDate:a.targetDate?new Date(a.targetDate):null,goalCreatedAt:a.goalCreatedAt?new Date(a.goalCreatedAt):null,tasks:e.tasks?JSON.parse(e.tasks):a.tasks||[],doneTasks:e.doneTasks?JSON.parse(e.doneTasks):a.doneTasks||[]},await f();try{await chrome.storage.sync.remove(["goalState","tasks","doneTasks"]),console.log("Cleared old sync storage data after migration")}catch(n){console.log("Could not clear old sync storage:",n)}}}_()}catch(t){console.error("Error loading state:",t),r={goal:"",targetDate:null,goalCreatedAt:null,tasks:[],doneTasks:[]}}}async function f(){const t={goal:r.goal,targetDate:r.targetDate?r.targetDate.toISOString():null,goalCreatedAt:r.goalCreatedAt?r.goalCreatedAt.toISOString():null};try{await chrome.storage.local.set({goalState:JSON.stringify(t)}),await chrome.storage.local.set({tasks:JSON.stringify(r.tasks)}),await chrome.storage.local.set({doneTasks:JSON.stringify(r.doneTasks)});try{await chrome.storage.sync.set({goalSettings:JSON.stringify(t)})}catch{console.log("Sync storage backup skipped (quota limit)")}}catch(e){throw console.error("Error saving to local storage:",e),e}}function D(){r.goal&&r.targetDate?(G(),i.goalTitle.textContent=`${r.goal}`,L()):(i.goalTitle.textContent="Click to set your goal...",N()),T(),w()}function G(){if(!r.targetDate)return"--";const t=new Date,e=new Date(r.targetDate);return Math.max(0,O(e,t))}function N(){i.days.textContent="--",i.hours.textContent="--",i.minutes.textContent="--",i.seconds.textContent="--"}function L(){if(!r.targetDate)return;const t=new Date,e=new Date(r.targetDate);if(t>=e){N();return}const a=O(e,t),n=Y(e,t)%24,o=j(e,t)%60,s=q(e,t)%60;i.days.textContent=String(a).padStart(2,"0"),i.hours.textContent=String(n).padStart(2,"0"),i.minutes.textContent=String(o).padStart(2,"0"),i.seconds.textContent=String(s).padStart(2,"0")}function Q(){L(),setInterval(L,1e3)}function V(t,e=""){return{title:t,description:e,createdAt:Date.now(),updatedAt:Date.now()}}function $(t,e){return{...t,...e,updatedAt:Date.now()}}function I(t){return[...t].sort((e,a)=>a.updatedAt-e.updatedAt)}function x(t,e,a){const n=document.createElement("div");n.className="task-item",n.draggable=!0,n.dataset.index=e,n.dataset.list=a?"done":"todo";const o=document.createElement("h3");if(o.textContent=t.title,n.appendChild(o),t.description){const d=document.createElement("p");d.textContent=t.description,n.appendChild(d)}const s=document.createElement("div");s.className="task-time";const c=Z(t.updatedAt);return s.textContent=`Updated ${c}`,n.appendChild(s),n.addEventListener("dragstart",at),n.addEventListener("click",()=>P(t,e,a)),n}function Z(t){const e=new Date(t),a=new Date,n=e.toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0}),o=e.toLocaleDateString("en-US",{month:"short",day:"numeric",year:e.getFullYear()!==a.getFullYear()?"numeric":void 0}),s=m(a),c=m(e),d=new Date(a);d.setDate(d.getDate()-1);const l=m(d);return c===s?`Today at ${n}`:c===l?`Yesterday at ${n}`:`${o} at ${n}`}function T(){if(!i.todoList||!i.doneList)return;i.todoList.innerHTML="",i.doneList.innerHTML="";const t=I(r.tasks),e=I(r.doneTasks);t.forEach(a=>{const n=r.tasks.findIndex(s=>s===a),o=x(a,n,!1);i.todoList.appendChild(o)}),e.forEach(a=>{const n=r.doneTasks.findIndex(s=>s===a),o=x(a,n,!0);i.doneList.appendChild(o)})}function P(t=null,e=null,a=!1){p=e,v=a?"done":"todo",t?(i.taskInput.value=t.title,i.taskDescription.value=t.description||""):(i.taskInput.value="",i.taskDescription.value=""),i.deleteTaskBtn&&(p!==null&&!a?i.deleteTaskBtn.style.display="inline-block":i.deleteTaskBtn.style.display="none"),i.taskModal.classList.add("show"),setTimeout(()=>i.taskInput.focus(),100)}function tt(t){t.key==="Enter"&&!t.shiftKey?(t.preventDefault(),H()):t.key==="Escape"&&(t.preventDefault(),y())}function H(){const t=i.taskInput.value.trim(),e=i.taskDescription.value.trim();if(t){if(p!==null){const a=v==="done"?r.doneTasks:r.tasks,n=a[p];a[p]=$(n,{title:t,description:e})}else r.tasks.push(V(t,e));f(),T(),y()}}function et(){if(p===null)return;const t=v==="done"?r.doneTasks:r.tasks;Array.isArray(t)&&t.splice(p,1),f(),D(),y()}function y(){i.taskModal.classList.remove("show"),p=null,v=null}function at(t){t.target.classList.add("dragging"),t.dataTransfer.setData("text/plain",JSON.stringify({index:t.target.dataset.index,list:t.target.dataset.list}))}function A(t){t.preventDefault();const e=t.target.closest(".task-list");e&&e.classList.add("drag-over")}function M(t){const e=t.target.closest(".task-list");e&&!e.contains(t.relatedTarget)&&e.classList.remove("drag-over")}function B(t){t.preventDefault();const e=t.target.closest(".task-list");if(!e)return;e.classList.remove("drag-over");const a=JSON.parse(t.dataTransfer.getData("text/plain")),n=a.list==="todo"?r.tasks:r.doneTasks,o=e.id==="todoList"?r.tasks:r.doneTasks;if(n===o)return;const s=n[a.index];s&&(e.id==="doneList"?(s.completedAt=Date.now(),s.updatedAt=Date.now(),F()):e.id==="todoList"&&(delete s.completedAt,s.updatedAt=Date.now()),n.splice(a.index,1),o.push(s),f(),T(),w())}function b(){r.goal&&(i.goalInput.value=r.goal),r.targetDate&&(i.dateInput.value=new Date(r.targetDate).toISOString().slice(0,16)),i.settingsModal.classList.add("show")}function h(){i.settingsModal.classList.remove("show")}function nt(){const t=i.goalInput.value.trim(),e=i.dateInput.value;t&&e&&((!r.goal||r.goal!==t)&&(r.goalCreatedAt=new Date),r.goal=t,r.targetDate=new Date(e),f(),D(),h())}function st(t,e,a){const n=parseInt(t.dataset.index),o=e==="todo"?r.tasks:r.doneTasks,s=a==="todo"?r.tasks:r.doneTasks,c=o[n];if(c){const d=$(c,{});a==="done"?(d.completedAt=Date.now(),F()):a==="todo"&&delete d.completedAt,o.splice(n,1),s.push(d),f(),T(),w()}}function ot(){if(!window.matchMedia("(max-width: 768px)").matches)return;const t=document.createElement("div");t.className="task-move-feedback",document.body.appendChild(t);let e=0,a=0;const n=50,o=500;function s(l,u){e=l.touches[0].clientX,a=Date.now(),u.classList.add("being-moved")}function c(l,u){const g=l.changedTouches[0].clientX,U=Date.now()-a,E=g-e;u.classList.remove("being-moved");const R=Math.abs(E)<n&&U<o,X=Math.abs(E)>n;if(R||X){const S=u.closest(".task-list").id==="todoList"?"todo":"done",C=S==="todo"?"done":"todo";t.textContent=`Moving to ${C==="todo"?"To-Do":"Done"}`,t.classList.add("visible"),i.listsContainer.classList.toggle("show-done"),setTimeout(()=>{st(u,S,C),t.classList.remove("visible")},300)}}function d(l,u){const k=l.touches[0].clientX-e;Math.abs(k)>n&&l.preventDefault()}[i.todoList,i.doneList].forEach(l=>{l.addEventListener("touchstart",u=>{const g=u.target.closest(".task-item");g&&s(u,g)},{passive:!1}),l.addEventListener("touchend",u=>{const g=u.target.closest(".task-item");g&&c(u,g)}),l.addEventListener("touchmove",u=>{u.target.closest(".task-item")&&d(u)},{passive:!1})})}function it(){i.addTaskBtn.addEventListener("click",()=>P()),i.saveTaskBtn.addEventListener("click",H),i.deleteTaskBtn.addEventListener("click",et),i.closeTaskBtn.addEventListener("click",y),i.settingsBtn.addEventListener("click",b),i.closeSettingsBtn.addEventListener("click",h),i.saveSettingsBtn.addEventListener("click",nt),i.nextList.addEventListener("click",()=>{i.listsContainer.classList.add("show-done")}),i.prevList.addEventListener("click",()=>{i.listsContainer.classList.remove("show-done")}),i.taskInput.addEventListener("keydown",tt),i.taskDescription.addEventListener("keydown",n=>{n.key==="Escape"&&(n.preventDefault(),y())}),ot(),window.matchMedia("(max-width: 768px)").matches||(i.todoList.addEventListener("dragover",A),i.todoList.addEventListener("dragleave",M),i.todoList.addEventListener("drop",B),i.doneList.addEventListener("dragover",A),i.doneList.addEventListener("dragleave",M),i.doneList.addEventListener("drop",B)),i.goalTitle.addEventListener("click",b),window.addEventListener("click",n=>{n.target===i.taskModal&&y(),n.target===i.settingsModal&&h()});const t=document.getElementById("exportBtn");t&&t.addEventListener("click",yt);const e=document.getElementById("importBtn"),a=document.getElementById("importInput");e&&a&&(e.addEventListener("click",()=>a.click()),a.addEventListener("change",n=>{n.target.files.length>0&&kt(n.target.files[0])}))}function w(){if(!i.activityMatrix||!r.goalCreatedAt)return;const t=rt();ut(t),ft(t)}function rt(){const t=dt(),e=[];if(!r.goalCreatedAt||!r.targetDate)return e;const a=new Date;a.setHours(23,59,59,999);const n=new Date(r.targetDate);n.setHours(23,59,59,999);const o=n>a?n:a,s=new Date(t);for(;s<=o;){const c=m(s),d=ct(c),l=m(new Date)===c,u=s>new Date;e.push({date:new Date(s),dateStr:c,count:d,level:u&&!l?-1:lt(d),dayOfWeek:s.getDay(),isToday:l,isFuture:u&&!l}),s.setDate(s.getDate()+1)}return e}function dt(){let t=r.goalCreatedAt?new Date(r.goalCreatedAt):new Date;const e=[...r.tasks,...r.doneTasks];if(e.length>0){const a=Math.min(...e.map(o=>o.createdAt||Date.now())),n=new Date(a);n<t&&(t=n)}return t.setHours(0,0,0,0),t}function m(t){const e=t.getFullYear(),a=String(t.getMonth()+1).padStart(2,"0"),n=String(t.getDate()).padStart(2,"0");return`${e}-${a}-${n}`}function ct(t){return r.doneTasks.filter(e=>{if(!e.completedAt)return!1;const a=new Date(e.completedAt);return m(a)===t}).length}function lt(t){return t===0?0:t<=2?1:t<=4?2:t<=6?3:4}function ut(t){i.activityMatrix.innerHTML="",t.forEach(e=>{const a=document.createElement("div");let n="matrix-day";e.level===-1?n+=" matrix-day-future":n+=` matrix-day-${e.level}`,e.isToday&&(n+=" matrix-day-today"),a.className=n,a.dataset.date=e.dateStr,a.dataset.count=e.count,a.addEventListener("mouseenter",gt),a.addEventListener("mouseleave",mt),a.addEventListener("mousemove",J),i.activityMatrix.appendChild(a)})}function gt(t){const e=t.target,a=e.dataset.date,n=parseInt(e.dataset.count),s=m(new Date),c=a===s,d=new Date(a+"T00:00:00"),l=a>s,u=d.toLocaleDateString("en-US",{weekday:"short",month:"short",day:"numeric",year:"numeric"});let g;l&&!c?g=`No activity yet on ${u}`:c?g=`${n} ${n===1?"task":"tasks"} completed today`:g=`${n} ${n===1?"task":"tasks"} completed on ${u}`,i.activityTooltip.textContent=g,i.activityTooltip.classList.add("visible"),J(t)}function mt(){i.activityTooltip.classList.remove("visible")}function J(t){const e=i.activityTooltip.getBoundingClientRect();let a=t.clientY+20,n=t.clientX+10;n+e.width>window.innerWidth-8&&(n=t.clientX-e.width-10),a+e.height>window.innerHeight-8&&(a=t.clientY-e.height-10),i.activityTooltip.style.position="fixed",i.activityTooltip.style.top=`${a}px`,i.activityTooltip.style.left=`${n}px`}function ft(t){if(!i.activityStats)return;const a=t.filter(s=>!s.isFuture).filter(s=>s.count>0).length,n=t.reduce((s,c)=>s+c.count,0),o=pt(t);i.activityStats.textContent=`${n} tasks completed across ${a} days (${o} day streak)`}function pt(t){let e=0;const a=new Date;a.setHours(0,0,0,0);const n=m(a);let o=-1;for(let s=t.length-1;s>=0;s--)if(t[s].dateStr===n){o=s;break}if(o===-1){for(let s=t.length-1;s>=0;s--)if(!t[s].isFuture&&t[s].count>0)e++;else if(!t[s].isFuture)break;return e}for(let s=o;s>=0&&t[s].count>0;s--)e++;return e}function yt(){const t={version:"1.0",exportDate:new Date().toISOString(),data:{goal:r.goal,targetDate:r.targetDate?r.targetDate.toISOString():null,goalCreatedAt:r.goalCreatedAt?r.goalCreatedAt.toISOString():null,tasks:r.tasks,doneTasks:r.doneTasks}},e=new Blob([JSON.stringify(t,null,2)],{type:"application/json"}),a=URL.createObjectURL(e),n=document.createElement("a");n.href=a,n.download=`launch-ext-backup-${m(new Date)}.json`,document.body.appendChild(n),n.click(),document.body.removeChild(n),URL.revokeObjectURL(a)}async function kt(t){try{const e=await t.text(),a=JSON.parse(e);if(!a.version||!a.data)throw new Error("Invalid backup file format");r={goal:a.data.goal||"",targetDate:a.data.targetDate?new Date(a.data.targetDate):null,goalCreatedAt:a.data.goalCreatedAt?new Date(a.data.goalCreatedAt):null,tasks:Array.isArray(a.data.tasks)?a.data.tasks:[],doneTasks:Array.isArray(a.data.doneTasks)?a.data.doneTasks:[]},await f(),D(),h(),alert("Data imported successfully!")}catch(e){console.error("Import error:",e),alert("Error importing data. Please make sure the file is a valid backup file.")}}function F(){const t=document.createElement("div");t.className="confetti-container",document.body.appendChild(t);const e=["#ff6b6b","#ff9500","#ffdd00","#4ecdc4","#45b7d1","#eb4d4b","#6c5ce7","#a29bfe"],a=["#ffff00","#ffffff","#ff8800","#ff4444"];for(let n=0;n<60;n++){const o=document.createElement("div");o.className="confetti";const s=Math.PI*2*n/60,c=200+Math.random()*300,d=e[Math.floor(Math.random()*e.length)];o.style.backgroundColor=d,o.style.setProperty("--burst-x",Math.cos(s)*c+"px"),o.style.setProperty("--burst-y",Math.sin(s)*c+"px"),o.style.animationDelay=Math.random()*.15+"s",o.style.animationDuration=2+Math.random()*1.5+"s",t.appendChild(o)}for(let n=0;n<40;n++){const o=document.createElement("div");o.className="confetti secondary";const s=Math.random()*Math.PI*2,c=150+Math.random()*200,d=e[Math.floor(Math.random()*e.length)];o.style.backgroundColor=d,o.style.setProperty("--burst-x",Math.cos(s)*c+"px"),o.style.setProperty("--burst-y",Math.sin(s)*c+"px"),o.style.animationDelay=.1+Math.random()*.2+"s",o.style.animationDuration=2.5+Math.random()*1+"s",t.appendChild(o)}for(let n=0;n<80;n++){const o=document.createElement("div");o.className="spark";const s=Math.random()*Math.PI*2,c=100+Math.random()*250,d=a[Math.floor(Math.random()*a.length)];o.style.backgroundColor=d,o.style.setProperty("--burst-x",Math.cos(s)*c+"px"),o.style.setProperty("--burst-y",Math.sin(s)*c+"px"),o.style.animationDelay=Math.random()*.3+"s",o.style.animationDuration=1.2+Math.random()*1+"s",t.appendChild(o)}setTimeout(()=>{document.body.contains(t)&&document.body.removeChild(t)},3e3)}K();
