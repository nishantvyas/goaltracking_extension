(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))s(i);new MutationObserver(i=>{for(const r of i)if(r.type==="childList")for(const d of r.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&s(d)}).observe(document,{childList:!0,subtree:!0});function n(i){const r={};return i.integrity&&(r.integrity=i.integrity),i.referrerPolicy&&(r.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?r.credentials="include":i.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function s(i){if(i.ep)return;i.ep=!0;const r=n(i);fetch(i.href,r)}})();function b(t,e){const n=t.getTime()-e.getTime();return Math.ceil(n/(1e3*60*60*24))}function W(t,e){const n=t.getTime()-e.getTime();return Math.floor(n/(1e3*60*60))}function Y(t,e){const n=t.getTime()-e.getTime();return Math.floor(n/(1e3*60))}function j(t,e){const n=t.getTime()-e.getTime();return Math.floor(n/1e3)}let o={goal:"",targetDate:null,goalCreatedAt:null,tasks:[],doneTasks:[]};const a={countdown:document.getElementById("countdown"),days:document.getElementById("days"),hours:document.getElementById("hours"),minutes:document.getElementById("minutes"),seconds:document.getElementById("seconds"),goalTitle:document.getElementById("goalTitle"),addTaskBtn:document.getElementById("addTaskBtn"),todoList:document.getElementById("todoList"),doneList:document.getElementById("doneList"),settingsBtn:document.getElementById("settingsBtn"),settingsModal:document.getElementById("settingsModal"),taskModal:document.getElementById("taskModal"),taskInput:document.getElementById("taskInput"),taskDescription:document.getElementById("taskDescription"),saveTaskBtn:document.getElementById("saveTaskBtn"),closeTaskBtn:document.getElementById("closeTaskBtn"),goalInput:document.getElementById("goalInput"),dateInput:document.getElementById("dateInput"),saveSettingsBtn:document.getElementById("saveSettingsBtn"),closeSettingsBtn:document.getElementById("closeSettingsBtn"),listsContainer:document.querySelector(".lists-container"),prevList:document.getElementById("prevList"),nextList:document.getElementById("nextList"),activityMatrix:document.getElementById("activityMatrix"),activityStats:document.getElementById("activityStats"),activityTooltip:document.getElementById("activityTooltip")};let f=null,h=null;async function F(){await K(),T(),nt(),_()}async function K(){try{const t=await chrome.storage.sync.get(["goalState"]);if(t.goalState){const e=JSON.parse(t.goalState);o={goal:e.goal||"",targetDate:e.targetDate?new Date(e.targetDate):null,goalCreatedAt:e.goalCreatedAt?new Date(e.goalCreatedAt):null,tasks:Array.isArray(e.tasks)?e.tasks:[],doneTasks:Array.isArray(e.doneTasks)?e.doneTasks:[]}}}catch(t){console.error("Error loading state:",t),o={goal:"",targetDate:null,goalCreatedAt:null,tasks:[],doneTasks:[]}}}async function p(){try{const t={...o,targetDate:o.targetDate?o.targetDate.toISOString():null,goalCreatedAt:o.goalCreatedAt?o.goalCreatedAt.toISOString():null};await chrome.storage.sync.set({goalState:JSON.stringify(t)})}catch(t){console.error("Error saving state:",t)}}function T(){o.goal&&o.targetDate?(q(),a.goalTitle.textContent=`${o.goal}`,D()):(a.goalTitle.textContent="Click to set your goal...",$()),y(),L()}function q(){if(!o.targetDate)return"--";const t=new Date,e=new Date(o.targetDate);return Math.max(0,b(e,t))}function $(){a.days.textContent="--",a.hours.textContent="--",a.minutes.textContent="--",a.seconds.textContent="--"}function D(){if(!o.targetDate)return;const t=new Date,e=new Date(o.targetDate);if(t>=e){$();return}const n=b(e,t),s=W(e,t)%24,i=Y(e,t)%60,r=j(e,t)%60;a.days.textContent=String(n).padStart(2,"0"),a.hours.textContent=String(s).padStart(2,"0"),a.minutes.textContent=String(i).padStart(2,"0"),a.seconds.textContent=String(r).padStart(2,"0")}function _(){D(),setInterval(D,1e3)}function G(t,e=""){return{title:t,description:e,createdAt:Date.now(),updatedAt:Date.now()}}function N(t,e){return{...t,...e,updatedAt:Date.now()}}function x(t){return[...t].sort((e,n)=>n.updatedAt-e.updatedAt)}function C(t,e,n){const s=document.createElement("div");s.className="task-item",s.draggable=!0,s.dataset.index=e,s.dataset.list=n?"done":"todo";const i=document.createElement("h3");if(i.textContent=t.title,s.appendChild(i),t.description){const c=document.createElement("p");c.textContent=t.description,s.appendChild(c)}const r=document.createElement("div");r.className="task-time";const d=z(t.updatedAt);return r.textContent=`Updated ${d}`,s.appendChild(r),s.addEventListener("dragstart",V),s.addEventListener("click",()=>H(t,e,n)),s}function z(t){const e=Date.now(),n=new Date(t),s=Math.floor((e-t)/1e3),i=Math.floor(s/60),r=Math.floor(i/60),d=Math.floor(r/24),c=n.toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0}),l=n.toLocaleDateString("en-US",{month:"short",day:"numeric",year:n.getFullYear()!==new Date().getFullYear()?"numeric":void 0});return d===0&&n.getDate()===new Date().getDate()?`Today at ${c}`:d===1||d===0&&n.getDate()===new Date().getDate()-1?`Yesterday at ${c}`:`${l} at ${c}`}function y(){if(!a.todoList||!a.doneList)return;a.todoList.innerHTML="",a.doneList.innerHTML="";const t=x(o.tasks),e=x(o.doneTasks);t.forEach(n=>{const s=o.tasks.findIndex(r=>r===n),i=C(n,s,!1);a.todoList.appendChild(i)}),e.forEach(n=>{const s=o.doneTasks.findIndex(r=>r===n),i=C(n,s,!0);a.doneList.appendChild(i)})}function H(t=null,e=null,n=!1){f=e,h=n?"done":"todo",t?(a.taskInput.value=t.title,a.taskDescription.value=t.description||""):(a.taskInput.value="",a.taskDescription.value=""),a.taskModal.classList.add("show"),setTimeout(()=>a.taskInput.focus(),100)}function Q(t){t.key==="Enter"&&!t.shiftKey?(t.preventDefault(),U()):t.key==="Escape"&&(t.preventDefault(),m())}function U(){const t=a.taskInput.value.trim(),e=a.taskDescription.value.trim();if(t){if(f!==null){const n=h==="done"?o.doneTasks:o.tasks,s=n[f];n[f]=N(s,{title:t,description:e})}else o.tasks.push(G(t,e));p(),y(),m()}}function m(){a.taskModal.classList.remove("show"),f=null,h=null}function V(t){t.target.classList.add("dragging"),t.dataTransfer.setData("text/plain",JSON.stringify({index:t.target.dataset.index,list:t.target.dataset.list}))}function B(t){t.preventDefault();const e=t.target.closest(".task-list");e&&e.classList.add("drag-over")}function A(t){const e=t.target.closest(".task-list");e&&!e.contains(t.relatedTarget)&&e.classList.remove("drag-over")}function M(t){t.preventDefault();const e=t.target.closest(".task-list");if(!e)return;e.classList.remove("drag-over");const n=JSON.parse(t.dataTransfer.getData("text/plain")),s=n.list==="todo"?o.tasks:o.doneTasks,i=e.id==="todoList"?o.tasks:o.doneTasks;if(s===i)return;const r=s[n.index];r&&(e.id==="doneList"?(r.completedAt=Date.now(),r.updatedAt=Date.now()):e.id==="todoList"&&(delete r.completedAt,r.updatedAt=Date.now()),s.splice(n.index,1),i.push(r),p(),y(),L())}function O(){o.goal&&(a.goalInput.value=o.goal),o.targetDate&&(a.dateInput.value=new Date(o.targetDate).toISOString().slice(0,16)),a.settingsModal.classList.add("show")}function k(){a.settingsModal.classList.remove("show")}function Z(){const t=a.goalInput.value.trim(),e=a.dateInput.value;t&&e&&((!o.goal||o.goal!==t)&&(o.goalCreatedAt=new Date),o.goal=t,o.targetDate=new Date(e),p(),T(),k())}function tt(t,e,n){const s=parseInt(t.dataset.index),i=e==="todo"?o.tasks:o.doneTasks,r=n==="todo"?o.tasks:o.doneTasks,d=i[s];if(d){const c=N(d,{});n==="done"?c.completedAt=Date.now():n==="todo"&&delete c.completedAt,i.splice(s,1),r.push(c),p(),y(),L()}}function et(){if(!window.matchMedia("(max-width: 768px)").matches)return;const t=document.createElement("div");t.className="task-move-feedback",document.body.appendChild(t);let e=0,n=0;const s=50,i=500;function r(l,u){e=l.touches[0].clientX,n=Date.now(),u.classList.add("being-moved")}function d(l,u){const g=l.changedTouches[0].clientX,P=Date.now()-n,w=g-e;u.classList.remove("being-moved");const R=Math.abs(w)<s&&P<i,J=Math.abs(w)>s;if(R||J){const S=u.closest(".task-list").id==="todoList"?"todo":"done",I=S==="todo"?"done":"todo";t.textContent=`Moving to ${I==="todo"?"To-Do":"Done"}`,t.classList.add("visible"),a.listsContainer.classList.toggle("show-done"),setTimeout(()=>{tt(u,S,I),t.classList.remove("visible")},300)}}function c(l,u){const E=l.touches[0].clientX-e;Math.abs(E)>s&&l.preventDefault()}[a.todoList,a.doneList].forEach(l=>{l.addEventListener("touchstart",u=>{const g=u.target.closest(".task-item");g&&r(u,g)},{passive:!1}),l.addEventListener("touchend",u=>{const g=u.target.closest(".task-item");g&&d(u,g)}),l.addEventListener("touchmove",u=>{u.target.closest(".task-item")&&c(u)},{passive:!1})})}function nt(){a.addTaskBtn.addEventListener("click",()=>H()),a.saveTaskBtn.addEventListener("click",U),a.closeTaskBtn.addEventListener("click",m),a.settingsBtn.addEventListener("click",O),a.closeSettingsBtn.addEventListener("click",k),a.saveSettingsBtn.addEventListener("click",Z),a.nextList.addEventListener("click",()=>{a.listsContainer.classList.add("show-done")}),a.prevList.addEventListener("click",()=>{a.listsContainer.classList.remove("show-done")}),a.taskInput.addEventListener("keydown",Q),a.taskDescription.addEventListener("keydown",s=>{s.key==="Escape"&&(s.preventDefault(),m())}),et(),window.matchMedia("(max-width: 768px)").matches||(a.todoList.addEventListener("dragover",B),a.todoList.addEventListener("dragleave",A),a.todoList.addEventListener("drop",M),a.doneList.addEventListener("dragover",B),a.doneList.addEventListener("dragleave",A),a.doneList.addEventListener("drop",M)),a.goalTitle.addEventListener("click",O),window.addEventListener("click",s=>{s.target===a.taskModal&&m(),s.target===a.settingsModal&&k()});const t=document.getElementById("exportBtn");t&&t.addEventListener("click",gt);const e=document.getElementById("importBtn"),n=document.getElementById("importInput");e&&n&&(e.addEventListener("click",()=>n.click()),n.addEventListener("change",s=>{s.target.files.length>0&&ft(s.target.files[0])}))}function L(){if(!a.activityMatrix||!o.goalCreatedAt)return;const t=at();rt(t),lt(t)}function at(){const t=st(),e=new Date,n=[],s=t.getDay();t.setDate(t.getDate()-s);const i=new Date(t);for(;i<=e;){const d=v(i),c=ot(d);n.push({date:new Date(i),dateStr:d,count:c,level:it(c),dayOfWeek:i.getDay()}),i.setDate(i.getDate()+1)}const r=e.getDay();if(r<6){const d=6-r,c=new Date(e);for(let l=1;l<=d;l++)c.setDate(c.getDate()+1),n.push({date:new Date(c),dateStr:v(c),count:0,level:0,dayOfWeek:c.getDay()})}return n}function st(){let t=o.goalCreatedAt?new Date(o.goalCreatedAt):new Date;const e=[...o.tasks,...o.doneTasks];if(e.length>0){const n=Math.min(...e.map(i=>i.createdAt||Date.now())),s=new Date(n);s<t&&(t=s)}return t.setHours(0,0,0,0),t}function v(t){return t.toISOString().split("T")[0]}function ot(t){return o.doneTasks.filter(e=>{if(!e.completedAt)return!1;const n=new Date(e.completedAt);return v(n)===t}).length}function it(t){return t===0?0:t<=2?1:t<=4?2:t<=6?3:4}function rt(t){a.activityMatrix.innerHTML="",t.forEach(e=>{const n=document.createElement("div");n.className=`matrix-day matrix-day-${e.level}`,n.dataset.date=e.dateStr,n.dataset.count=e.count,n.addEventListener("mouseenter",dt),n.addEventListener("mouseleave",ct),n.addEventListener("mousemove",X),a.activityMatrix.appendChild(n)})}function dt(t){const e=t.target,n=new Date(e.dataset.date),s=parseInt(e.dataset.count),i=n.toLocaleDateString("en-US",{weekday:"short",month:"short",day:"numeric",year:"numeric"}),d=`${s} ${s===1?"task":"tasks"} completed on ${i}`;a.activityTooltip.textContent=d,a.activityTooltip.classList.add("visible"),X(t)}function ct(){a.activityTooltip.classList.remove("visible")}function X(t){const e=a.activityTooltip.getBoundingClientRect();let n=t.clientY+20,s=t.clientX+10;s+e.width>window.innerWidth-8&&(s=t.clientX-e.width-10),n+e.height>window.innerHeight-8&&(n=t.clientY-e.height-10),a.activityTooltip.style.position="fixed",a.activityTooltip.style.top=`${n}px`,a.activityTooltip.style.left=`${s}px`}function lt(t){if(!a.activityStats)return;t.length;const e=t.filter(i=>i.count>0).length,n=t.reduce((i,r)=>i+r.count,0),s=ut(t);a.activityStats.textContent=`${n} tasks completed across ${e} days (${s} day streak)`}function ut(t){let e=0;for(let n=t.length-1;n>=0&&t[n].count>0;n--)e++;return e}function gt(){const t={version:"1.0",exportDate:new Date().toISOString(),data:{goal:o.goal,targetDate:o.targetDate?o.targetDate.toISOString():null,goalCreatedAt:o.goalCreatedAt?o.goalCreatedAt.toISOString():null,tasks:o.tasks,doneTasks:o.doneTasks}},e=new Blob([JSON.stringify(t,null,2)],{type:"application/json"}),n=URL.createObjectURL(e),s=document.createElement("a");s.href=n,s.download=`launch-ext-backup-${v(new Date)}.json`,document.body.appendChild(s),s.click(),document.body.removeChild(s),URL.revokeObjectURL(n)}async function ft(t){try{const e=await t.text(),n=JSON.parse(e);if(!n.version||!n.data)throw new Error("Invalid backup file format");o={goal:n.data.goal||"",targetDate:n.data.targetDate?new Date(n.data.targetDate):null,goalCreatedAt:n.data.goalCreatedAt?new Date(n.data.goalCreatedAt):null,tasks:Array.isArray(n.data.tasks)?n.data.tasks:[],doneTasks:Array.isArray(n.data.doneTasks)?n.data.doneTasks:[]},await p(),T(),k(),alert("Data imported successfully!")}catch(e){console.error("Import error:",e),alert("Error importing data. Please make sure the file is a valid backup file.")}}F();
