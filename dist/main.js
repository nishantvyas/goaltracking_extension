(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))a(n);new MutationObserver(n=>{for(const r of n)if(r.type==="childList")for(const i of r.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&a(i)}).observe(document,{childList:!0,subtree:!0});function o(n){const r={};return n.integrity&&(r.integrity=n.integrity),n.referrerPolicy&&(r.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?r.credentials="include":n.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function a(n){if(n.ep)return;n.ep=!0;const r=o(n);fetch(n.href,r)}})();function z(t,e){const o=t.getTime()-e.getTime();return Math.ceil(o/(1e3*60*60*24))}function K(t,e){const o=t.getTime()-e.getTime();return Math.floor(o/(1e3*60*60))}function W(t,e){const o=t.getTime()-e.getTime();return Math.floor(o/(1e3*60))}function G(t,e){const o=t.getTime()-e.getTime();return Math.floor(o/1e3)}let c={projects:{},activeProjectId:null,projectOrder:[],globalSettings:{theme:"dark",defaultProjectColor:"#4CAF50",showCompletedProjects:!1,maxProjects:10},migrationVersion:2,goal:"",targetDate:null,goalCreatedAt:null,tasks:[],doneTasks:[]};class Q{constructor(){this.state=c}generateProjectId(){return"project_"+Date.now()+"_"+Math.random().toString(36).substr(2,9)}async createProject(e){const o=this.generateProjectId(),a={id:o,goal:e.goal||"New Project",targetDate:e.targetDate||null,goalCreatedAt:e.goalCreatedAt||new Date,tasks:e.tasks||[],doneTasks:e.doneTasks||[],color:e.color||this.state.globalSettings.defaultProjectColor,isActive:!0,order:this.state.projectOrder.length,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()};return this.state.projects[o]=a,this.state.projectOrder.push(o),this.state.activeProjectId||(this.state.activeProjectId=o),await p(),a}getProject(e){return this.state.projects[e]||null}async updateProject(e,o){return this.state.projects[e]?(this.state.projects[e]={...this.state.projects[e],...o,updatedAt:new Date().toISOString()},await p(),this.state.projects[e]):null}async deleteProject(e){return this.state.projects[e]?(delete this.state.projects[e],this.state.projectOrder=this.state.projectOrder.filter(o=>o!==e),this.state.activeProjectId===e&&(this.state.activeProjectId=this.state.projectOrder.length>0?this.state.projectOrder[0]:null),await p(),!0):!1}getActiveProject(){return this.state.activeProjectId?this.state.projects[this.state.activeProjectId]:null}async setActiveProject(e){return this.state.projects[e]?(this.state.activeProjectId=e,await p(),!0):!1}getAllProjects(){return this.state.projectOrder.map(e=>this.state.projects[e]).filter(Boolean)}getActiveProjects(){return this.getAllProjects().filter(e=>e.isActive)}}const u=new Q,s={countdown:document.getElementById("countdown"),days:document.getElementById("days"),hours:document.getElementById("hours"),minutes:document.getElementById("minutes"),seconds:document.getElementById("seconds"),goalTitle:document.getElementById("goalTitle"),addTaskBtn:document.getElementById("addTaskBtn"),todoList:document.getElementById("todoList"),doneList:document.getElementById("doneList"),settingsBtn:document.getElementById("settingsBtn"),settingsModal:document.getElementById("settingsModal"),taskModal:document.getElementById("taskModal"),taskInput:document.getElementById("taskInput"),taskDescription:document.getElementById("taskDescription"),saveTaskBtn:document.getElementById("saveTaskBtn"),deleteTaskBtn:document.getElementById("deleteTaskBtn"),closeTaskBtn:document.getElementById("closeTaskBtn"),goalInput:document.getElementById("goalInput"),dateInput:document.getElementById("dateInput"),saveSettingsBtn:document.getElementById("saveSettingsBtn"),closeSettingsBtn:document.getElementById("closeSettingsBtn"),listsContainer:document.querySelector(".lists-container"),prevList:document.getElementById("prevList"),nextList:document.getElementById("nextList"),activityMatrix:document.getElementById("activityMatrix"),activityStats:document.getElementById("activityStats"),activityTooltip:document.getElementById("activityTooltip"),projectDropdownBtn:document.getElementById("projectDropdownBtn"),projectDropdownMenu:document.getElementById("projectDropdownMenu"),currentProjectName:document.getElementById("currentProjectName"),addProjectBtn:document.getElementById("addProjectBtn"),projectList:document.getElementById("projectList"),projectDropdown:document.querySelector(".project-dropdown"),settingsTabs:document.querySelectorAll(".settings-tab"),settingsTabContents:document.querySelectorAll(".settings-tab-content"),projectColorInput:document.getElementById("projectColorInput"),deleteProjectBtn:document.getElementById("deleteProjectBtn"),allProjectsList:document.getElementById("allProjectsList")};let h=null,T=null;async function Z(){await ot(),tt(),y(),jt(),ut()}function tt(){let t=!1;c.doneTasks.forEach(e=>{e.completedAt&&!e.timestampMigrated&&(e.timestampMigrated=!0,t=!0)}),c.tasks.forEach(e=>{(e.createdAt||e.updatedAt)&&!e.timestampMigrated&&(e.timestampMigrated=!0,t=!0)}),t&&(console.log("Marked tasks as migrated to new timezone handling"),p())}function et(){if(!c.projects)return;const t=new Date,e=new Date(t.getTime()-90*24*60*60*1e3);let o=0;Object.keys(c.projects).forEach(a=>{const n=c.projects[a];if(!Array.isArray(n.doneTasks)||n.doneTasks.length<=1e3)return;const i=[...n.doneTasks].sort((d,f)=>new Date(f.completedAt||f.updatedAt||f.createdAt)-new Date(d.completedAt||d.updatedAt||d.createdAt)).slice(0,1e3),g=new Set(i.map(d=>d.id)),m=n.doneTasks.filter(d=>g.has(d.id)?!1:new Date(d.completedAt||d.updatedAt||d.createdAt)>=e),l=[...i,...m];if(l.length<n.doneTasks.length){const d=n.doneTasks.length-l.length;o+=d,n.doneTasks=l}}),o>0&&(console.log(`Cleaned up ${o} old completed tasks across all projects`),p())}async function ot(){try{const t=await chrome.storage.local.get(["projects_data","global_settings","active_project","project_order","migration_version"]);t.migration_version===2&&t.projects_data?(console.log("Loading multi-project data"),c={projects:JSON.parse(t.projects_data),activeProjectId:t.active_project,projectOrder:JSON.parse(t.project_order||"[]"),globalSettings:JSON.parse(t.global_settings||"{}"),migrationVersion:2,goal:"",targetDate:null,goalCreatedAt:null,tasks:[],doneTasks:[]},c.globalSettings={theme:"dark",defaultProjectColor:"#4CAF50",showCompletedProjects:!1,maxProjects:10,...c.globalSettings}):(console.log("Checking for single-project data to migrate"),await at()),et()}catch(t){console.error("Error loading state:",t),await O()}}async function at(){console.log("Starting migration to multi-project structure");try{const t=await chrome.storage.local.get(["goalState","tasks","doneTasks"]);let e=!1,o={goal:"My First Project",targetDate:null,goalCreatedAt:new Date,tasks:[],doneTasks:[]};if(t.goalState){console.log("Found old single-project data, migrating...");const a=JSON.parse(t.goalState);o={goal:a.goal||"My First Project",targetDate:a.targetDate?new Date(a.targetDate):null,goalCreatedAt:a.goalCreatedAt?new Date(a.goalCreatedAt):new Date,tasks:t.tasks?JSON.parse(t.tasks):a.tasks||[],doneTasks:t.doneTasks?JSON.parse(t.doneTasks):a.doneTasks||[]},e=!0}else{const a=await chrome.storage.sync.get(["goalState","tasks","doneTasks"]);if(a.goalState){console.log("Found old sync storage data, migrating...");const n=JSON.parse(a.goalState);o={goal:n.goal||"My First Project",targetDate:n.targetDate?new Date(n.targetDate):null,goalCreatedAt:n.goalCreatedAt?new Date(n.goalCreatedAt):new Date,tasks:a.tasks?JSON.parse(a.tasks):n.tasks||[],doneTasks:a.doneTasks?JSON.parse(a.doneTasks):n.doneTasks||[]},e=!0}}c={projects:{},activeProjectId:null,projectOrder:[],globalSettings:{theme:"dark",defaultProjectColor:"#4CAF50",showCompletedProjects:!1,maxProjects:10},migrationVersion:2,goal:"",targetDate:null,goalCreatedAt:null,tasks:[],doneTasks:[]},e&&(console.log("Creating first project from migrated data"),await u.createProject(o)),await p(),await nt(),console.log("Migration completed successfully")}catch(t){console.error("Migration failed:",t),await O()}}async function O(){console.log("Initializing default multi-project state"),c={projects:{},activeProjectId:null,projectOrder:[],globalSettings:{theme:"dark",defaultProjectColor:"#4CAF50",showCompletedProjects:!1,maxProjects:10},migrationVersion:2,goal:"",targetDate:null,goalCreatedAt:null,tasks:[],doneTasks:[]},await p()}async function nt(){try{await chrome.storage.local.remove(["goalState","tasks","doneTasks"]),await chrome.storage.sync.remove(["goalState","tasks","doneTasks","goalSettings"]),console.log("Cleaned up old storage keys")}catch(t){console.log("Could not clean up old storage:",t)}}async function p(){try{await chrome.storage.local.set({projects_data:JSON.stringify(c.projects),global_settings:JSON.stringify(c.globalSettings),active_project:c.activeProjectId,project_order:JSON.stringify(c.projectOrder),migration_version:c.migrationVersion});try{const t={projectIds:Object.keys(c.projects),activeProjectId:c.activeProjectId,globalSettings:c.globalSettings,migrationVersion:c.migrationVersion};await chrome.storage.sync.set({projects_metadata:JSON.stringify(t)})}catch{console.log("Sync storage backup skipped (quota limit)")}}catch(t){throw console.error("Error saving to local storage:",t),t}}function y(){const t=u.getActiveProject();t&&t.goal&&t.targetDate?(s.goalTitle.textContent=`${t.goal}`,w()):(s.goalTitle.textContent="Click to set your goal...",_()),D(),L(),st()}function st(){const t=u.getActiveProject(),e=u.getActiveProjects();if(t?(s.currentProjectName.textContent=t.goal||"Untitled Project",document.title=`Launch Extension - ${t.goal}`):(s.currentProjectName.textContent="No Project Selected",document.title="Launch Extension"),s.projectList&&(s.projectList.innerHTML="",e.forEach(o=>{const a=document.createElement("div");a.className=`project-item ${o.id===c.activeProjectId?"active":""}`,a.dataset.projectId=o.id,a.innerHTML=`
                <div class="project-color" style="background-color: ${o.color}"></div>
                <div class="project-info">
                    <div class="project-name">${o.goal||"Untitled Project"}</div>
                    <div class="project-meta">
                        ${o.tasks.length} tasks • ${o.doneTasks.length} done
                    </div>
                </div>
            `,a.addEventListener("click",()=>$(o.id)),s.projectList.appendChild(a)}),e.length===0)){const o=document.createElement("div");o.className="project-empty-state",o.innerHTML=`
                <div style="padding: 1rem; text-align: center; color: rgba(255, 255, 255, 0.6);">
                    No projects yet. Click + to create one!
                </div>
            `,s.projectList.appendChild(o)}}async function $(t){await u.setActiveProject(t),y(),P()}function rt(){s.projectDropdown.classList.toggle("open")}function P(){s.projectDropdown.classList.remove("open")}async function it(){const t=prompt("Enter project name:");if(t&&t.trim()){const e=prompt("Enter target date (YYYY-MM-DD):");if(e)try{const o=await u.createProject({goal:t.trim(),targetDate:new Date(e),goalCreatedAt:new Date});await u.setActiveProject(o.id),y(),P()}catch{alert("Error creating project. Please check the date format.")}}}function N(t){s.settingsTabs.forEach(a=>a.classList.remove("active")),s.settingsTabContents.forEach(a=>a.classList.remove("active"));const e=document.querySelector(`[data-tab="${t}"]`),o=document.getElementById(`${t}Tab`);e&&e.classList.add("active"),o&&o.classList.add("active")}function F(){if(!s.allProjectsList)return;const t=u.getAllProjects();s.allProjectsList.innerHTML="",t.forEach(e=>{const o=e.id===c.activeProjectId,a=document.createElement("div");a.className=`all-project-item ${o?"active":""}`;const n=e.doneTasks.length>0?Math.round(e.doneTasks.length/(e.tasks.length+e.doneTasks.length)*100):0;a.innerHTML=`
            <div class="all-project-color" style="background-color: ${e.color}"></div>
            <div class="all-project-info">
                <div class="all-project-name">${e.goal||"Untitled Project"}</div>
                <div class="all-project-details">
                    ${e.tasks.length} todo, ${e.doneTasks.length} done (${n}%)
                </div>
            </div>
            <div class="all-project-actions">
                <button class="project-action-btn" onclick="switchToProject('${e.id}')">
                    ${o?"Active":"Switch"}
                </button>
                <button class="project-action-btn" onclick="deleteProjectById('${e.id}')">
                    Delete
                </button>
            </div>
        `,s.allProjectsList.appendChild(a)}),t.length===0&&(s.allProjectsList.innerHTML=`
            <div style="text-align: center; padding: 2rem; color: rgba(255, 255, 255, 0.6);">
                No projects yet. Create your first project!
            </div>
        `)}async function ct(){const t=u.getActiveProject();t&&confirm(`Are you sure you want to delete "${t.goal}"? This cannot be undone.`)&&(await u.deleteProject(t.id),y(),j())}async function dt(t){const e=u.getProject(t);e&&confirm(`Are you sure you want to delete "${e.goal}"? This cannot be undone.`)&&(await u.deleteProject(t),y(),F())}async function lt(){const t=u.getActiveProject();if(!t||!s.projectColorInput)return;const e=s.projectColorInput.value;await u.updateProject(t.id,{color:e}),y()}function _(){s.days.textContent="--",s.hours.textContent="--",s.minutes.textContent="--",s.seconds.textContent="--"}function w(){const t=u.getActiveProject();if(!t||!t.targetDate)return;const e=new Date,o=new Date(t.targetDate);if(e>=o){_();return}const a=z(o,e),n=K(o,e)%24,r=W(o,e)%60,i=G(o,e)%60;s.days.textContent=String(a).padStart(2,"0"),s.hours.textContent=String(n).padStart(2,"0"),s.minutes.textContent=String(r).padStart(2,"0"),s.seconds.textContent=String(i).padStart(2,"0")}function ut(){w(),setInterval(w,1e3)}function gt(t,e=""){return{title:t,description:e,createdAt:Date.now(),updatedAt:Date.now()}}function H(t,e){return{...t,...e,updatedAt:Date.now()}}function I(t){return[...t].sort((e,o)=>o.updatedAt-e.updatedAt)}function A(t,e,o){const a=document.createElement("div");a.className="task-item",a.draggable=!0,a.dataset.index=e,a.dataset.list=o?"done":"todo";const n=document.createElement("h3");if(n.textContent=t.title,a.appendChild(n),t.description){const g=document.createElement("p");g.textContent=t.description,a.appendChild(g)}const r=document.createElement("div");r.className="task-time";const i=mt(t.updatedAt);return r.textContent=`Updated ${i}`,a.appendChild(r),a.addEventListener("dragstart",vt),a.addEventListener("click",()=>J(t,e,o)),a}function mt(t){const e=new Date(t),o=new Date,a=e.toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0}),n=e.toLocaleDateString("en-US",{month:"short",day:"numeric",year:e.getFullYear()!==o.getFullYear()?"numeric":void 0}),r=v(o),i=v(e),g=new Date(o);g.setDate(g.getDate()-1);const m=v(g);return i===r?`Today at ${a}`:i===m?`Yesterday at ${a}`:`${n} at ${a}`}function D(){if(!s.todoList||!s.doneList)return;s.todoList.innerHTML="",s.doneList.innerHTML="";const t=u.getActiveProject();if(!t)return;const e=I(t.tasks),o=I(t.doneTasks);e.forEach(a=>{const n=t.tasks.findIndex(i=>i===a),r=A(a,n,!1);s.todoList.appendChild(r)}),o.forEach(a=>{const n=t.doneTasks.findIndex(i=>i===a),r=A(a,n,!0);s.doneList.appendChild(r)})}function J(t=null,e=null,o=!1){h=e,T=o?"done":"todo",t?(s.taskInput.value=t.title,s.taskDescription.value=t.description||""):(s.taskInput.value="",s.taskDescription.value=""),s.deleteTaskBtn&&(h!==null&&!o?s.deleteTaskBtn.style.display="inline-block":s.deleteTaskBtn.style.display="none"),s.taskModal.classList.add("show"),setTimeout(()=>s.taskInput.focus(),100)}function pt(t){t.key==="Enter"&&!t.shiftKey?(t.preventDefault(),U()):t.key==="Escape"&&(t.preventDefault(),k())}function U(){const t=s.taskInput.value.trim(),e=s.taskDescription.value.trim();if(!t)return;const o=u.getActiveProject();if(o){if(h!==null){const a=T==="done"?o.doneTasks:o.tasks,n=a[h];a[h]=H(n,{title:t,description:e})}else o.tasks.push(gt(t,e));p(),D(),k()}}function ft(){if(h===null)return;const t=u.getActiveProject();if(!t)return;const e=T==="done"?t.doneTasks:t.tasks;Array.isArray(e)&&e.splice(h,1),p(),y(),k()}function k(){s.taskModal.classList.remove("show"),h=null,T=null}function vt(t){t.target.classList.add("dragging"),t.dataTransfer.setData("text/plain",JSON.stringify({index:t.target.dataset.index,list:t.target.dataset.list}))}function b(t){t.preventDefault();const e=t.target.closest(".task-list");e&&e.classList.add("drag-over")}function M(t){const e=t.target.closest(".task-list");e&&!e.contains(t.relatedTarget)&&e.classList.remove("drag-over")}function B(t){t.preventDefault();const e=t.target.closest(".task-list");if(!e)return;const o=u.getActiveProject();if(!o)return;e.classList.remove("drag-over");const a=JSON.parse(t.dataTransfer.getData("text/plain")),n=a.list==="todo"?o.tasks:o.doneTasks,r=e.id==="todoList"?o.tasks:o.doneTasks;if(n===r)return;const i=n[a.index];i&&(e.id==="doneList"?(i.completedAt=Date.now(),i.updatedAt=Date.now(),Y()):e.id==="todoList"&&(delete i.completedAt,i.updatedAt=Date.now()),n.splice(a.index,1),r.push(i),p(),D(),L())}function x(){const t=u.getActiveProject();t&&(t.goal&&(s.goalInput.value=t.goal),t.targetDate&&(s.dateInput.value=new Date(t.targetDate).toISOString().slice(0,16)),s.projectColorInput&&(s.projectColorInput.value=t.color||"#4CAF50")),F(),N("current"),s.settingsModal.classList.add("show")}function j(){s.settingsModal.classList.remove("show")}async function yt(){const t=s.goalInput.value.trim(),e=s.dateInput.value;if(t&&e){let o=u.getActiveProject();if(!o)o=await u.createProject({goal:t,targetDate:new Date(e),goalCreatedAt:new Date});else{const a={goal:t,targetDate:new Date(e)};(!o.goal||o.goal!==t)&&(a.goalCreatedAt=new Date),await u.updateProject(o.id,a)}y(),j()}}function ht(t,e,o){const a=parseInt(t.dataset.index),n=u.getActiveProject();if(!n)return;const r=e==="todo"?n.tasks:n.doneTasks,i=o==="todo"?n.tasks:n.doneTasks,g=r[a];if(g){const m=H(g,{});o==="done"?(m.completedAt=Date.now(),Y()):o==="todo"&&delete m.completedAt,r.splice(a,1),i.push(m),p(),D(),L()}}function kt(){if(!window.matchMedia("(max-width: 768px)").matches)return;const t=document.createElement("div");t.className="task-move-feedback",document.body.appendChild(t);let e=0,o=0;const a=50,n=500;function r(m,l){e=m.touches[0].clientX,o=Date.now(),l.classList.add("being-moved")}function i(m,l){const d=m.changedTouches[0].clientX,X=Date.now()-o,S=d-e;l.classList.remove("being-moved");const V=Math.abs(S)<a&&X<n,q=Math.abs(S)>a;if(V||q){const E=l.closest(".task-list").id==="todoList"?"todo":"done",C=E==="todo"?"done":"todo";t.textContent=`Moving to ${C==="todo"?"To-Do":"Done"}`,t.classList.add("visible"),s.listsContainer.classList.toggle("show-done"),setTimeout(()=>{ht(l,E,C),t.classList.remove("visible")},300)}}function g(m,l){const f=m.touches[0].clientX-e;Math.abs(f)>a&&m.preventDefault()}[s.todoList,s.doneList].forEach(m=>{m.addEventListener("touchstart",l=>{const d=l.target.closest(".task-item");d&&r(l,d)},{passive:!1}),m.addEventListener("touchend",l=>{const d=l.target.closest(".task-item");d&&i(l,d)}),m.addEventListener("touchmove",l=>{l.target.closest(".task-item")&&g(l)},{passive:!1})})}function jt(){s.projectDropdownBtn.addEventListener("click",rt),s.addProjectBtn.addEventListener("click",it),s.settingsTabs.forEach(a=>{a.addEventListener("click",()=>N(a.dataset.tab))}),s.deleteProjectBtn&&s.deleteProjectBtn.addEventListener("click",ct),s.projectColorInput&&s.projectColorInput.addEventListener("change",lt),document.addEventListener("click",a=>{s.projectDropdown.contains(a.target)||P()}),s.addTaskBtn.addEventListener("click",()=>J()),s.saveTaskBtn.addEventListener("click",U),s.deleteTaskBtn.addEventListener("click",ft),s.closeTaskBtn.addEventListener("click",k),s.settingsBtn.addEventListener("click",x),s.closeSettingsBtn.addEventListener("click",j),s.saveSettingsBtn.addEventListener("click",yt),s.nextList.addEventListener("click",()=>{s.listsContainer.classList.add("show-done")}),s.prevList.addEventListener("click",()=>{s.listsContainer.classList.remove("show-done")}),s.taskInput.addEventListener("keydown",pt),s.taskDescription.addEventListener("keydown",a=>{a.key==="Escape"&&(a.preventDefault(),k())}),kt(),window.matchMedia("(max-width: 768px)").matches||(s.todoList.addEventListener("dragover",b),s.todoList.addEventListener("dragleave",M),s.todoList.addEventListener("drop",B),s.doneList.addEventListener("dragover",b),s.doneList.addEventListener("dragleave",M),s.doneList.addEventListener("drop",B)),s.goalTitle.addEventListener("click",x),window.addEventListener("click",a=>{a.target===s.taskModal&&k(),a.target===s.settingsModal&&j()});const t=document.getElementById("exportBtn");t&&t.addEventListener("click",At);const e=document.getElementById("importBtn"),o=document.getElementById("importInput");e&&o&&(e.addEventListener("click",()=>o.click()),o.addEventListener("change",a=>{a.target.files.length>0&&bt(a.target.files[0])}))}function L(){const t=u.getActiveProject();if(!s.activityMatrix||!t||!t.goalCreatedAt)return;const e=Tt(t);Lt(e),Ct(e)}function Tt(t){const e=Dt(t),o=[];if(!t||!t.goalCreatedAt||!t.targetDate)return o;const a=new Date;a.setHours(23,59,59,999);const n=new Date(t.targetDate);n.setHours(23,59,59,999);const r=n>a?n:a,i=new Date(e);for(;i<=r;){const g=v(i),m=wt(g,t),l=v(new Date)===g,d=i>new Date;o.push({date:new Date(i),dateStr:g,count:m,level:d&&!l?-1:Pt(m),dayOfWeek:i.getDay(),isToday:l,isFuture:d&&!l}),i.setDate(i.getDate()+1)}return o}function Dt(t){let e=t.goalCreatedAt?new Date(t.goalCreatedAt):new Date;const o=[...t.tasks,...t.doneTasks];if(o.length>0){const a=Math.min(...o.map(r=>r.createdAt||Date.now())),n=new Date(a);n<e&&(e=n)}return e.setHours(0,0,0,0),e}function v(t){const e=t.getFullYear(),o=String(t.getMonth()+1).padStart(2,"0"),a=String(t.getDate()).padStart(2,"0");return`${e}-${o}-${a}`}function wt(t,e){return e.doneTasks.filter(o=>{if(!o.completedAt)return!1;const a=new Date(o.completedAt);return v(a)===t}).length}function Pt(t){return t===0?0:t<=2?1:t<=4?2:t<=6?3:4}function Lt(t){s.activityMatrix.innerHTML="",t.forEach(e=>{const o=document.createElement("div");let a="matrix-day";e.level===-1?a+=" matrix-day-future":a+=` matrix-day-${e.level}`,e.isToday&&(a+=" matrix-day-today"),o.className=a,o.dataset.date=e.dateStr,o.dataset.count=e.count,o.addEventListener("mouseenter",St),o.addEventListener("mouseleave",Et),o.addEventListener("mousemove",R),s.activityMatrix.appendChild(o)})}function St(t){const e=t.target,o=e.dataset.date,a=parseInt(e.dataset.count),r=v(new Date),i=o===r,g=new Date(o+"T00:00:00"),m=o>r,l=g.toLocaleDateString("en-US",{weekday:"short",month:"short",day:"numeric",year:"numeric"});let d;m&&!i?d=`No activity yet on ${l}`:i?d=`${a} ${a===1?"task":"tasks"} completed today`:d=`${a} ${a===1?"task":"tasks"} completed on ${l}`,s.activityTooltip.textContent=d,s.activityTooltip.classList.add("visible"),R(t)}function Et(){s.activityTooltip.classList.remove("visible")}function R(t){const e=s.activityTooltip.getBoundingClientRect();let o=t.clientY+20,a=t.clientX+10;a+e.width>window.innerWidth-8&&(a=t.clientX-e.width-10),o+e.height>window.innerHeight-8&&(o=t.clientY-e.height-10),s.activityTooltip.style.position="fixed",s.activityTooltip.style.top=`${o}px`,s.activityTooltip.style.left=`${a}px`}function Ct(t){if(!s.activityStats)return;const o=t.filter(r=>!r.isFuture).filter(r=>r.count>0).length,a=t.reduce((r,i)=>r+i.count,0),n=It(t);s.activityStats.textContent=`${a} tasks completed across ${o} days (${n} day streak)`}function It(t){let e=0;const o=new Date;o.setHours(0,0,0,0);const a=v(o);let n=-1;for(let r=t.length-1;r>=0;r--)if(t[r].dateStr===a){n=r;break}if(n===-1){for(let r=t.length-1;r>=0;r--)if(!t[r].isFuture&&t[r].count>0)e++;else if(!t[r].isFuture)break;return e}for(let r=n;r>=0&&t[r].count>0;r--)e++;return e}function At(){const t={version:"1.0",exportDate:new Date().toISOString(),data:{goal:c.goal,targetDate:c.targetDate?c.targetDate.toISOString():null,goalCreatedAt:c.goalCreatedAt?c.goalCreatedAt.toISOString():null,tasks:c.tasks,doneTasks:c.doneTasks}},e=new Blob([JSON.stringify(t,null,2)],{type:"application/json"}),o=URL.createObjectURL(e),a=document.createElement("a");a.href=o,a.download=`launch-ext-backup-${v(new Date)}.json`,document.body.appendChild(a),a.click(),document.body.removeChild(a),URL.revokeObjectURL(o)}async function bt(t){try{const e=await t.text(),o=JSON.parse(e);if(!o.version||!o.data)throw new Error("Invalid backup file format");if(o.data.projects)console.log("Importing multi-project data"),c.projects=o.data.projects,c.activeProjectId=o.data.activeProjectId,c.projectOrder=o.data.projectOrder||Object.keys(o.data.projects),c.globalSettings={...c.globalSettings,...o.data.globalSettings||{}};else{console.log("Converting old single-project data to multi-project format");const n=u.generateProjectId(),r={id:n,goal:o.data.goal||"Imported Project",targetDate:o.data.targetDate?new Date(o.data.targetDate):null,goalCreatedAt:o.data.goalCreatedAt?new Date(o.data.goalCreatedAt):new Date,tasks:Array.isArray(o.data.tasks)?o.data.tasks:[],doneTasks:Array.isArray(o.data.doneTasks)?o.data.doneTasks:[],color:"#4CAF50",isActive:!0,order:0,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()};c.projects[n]=r,c.activeProjectId=n,c.projectOrder=[n]}c.migrationVersion=2,await p(),y(),j();const a=Object.keys(c.projects).length;alert(`Data imported successfully! ${a} project(s) imported.`)}catch(e){console.error("Import error:",e),alert("Error importing data. Please make sure the file is a valid backup file.")}}function Y(){const t=document.createElement("div");t.className="confetti-container",document.body.appendChild(t);const e=["#ff6b6b","#ff9500","#ffdd00","#4ecdc4","#45b7d1","#eb4d4b","#6c5ce7","#a29bfe"],o=["#ffff00","#ffffff","#ff8800","#ff4444"];for(let a=0;a<60;a++){const n=document.createElement("div");n.className="confetti";const r=Math.PI*2*a/60,i=200+Math.random()*300,g=e[Math.floor(Math.random()*e.length)];n.style.backgroundColor=g,n.style.setProperty("--burst-x",Math.cos(r)*i+"px"),n.style.setProperty("--burst-y",Math.sin(r)*i+"px"),n.style.animationDelay=Math.random()*.15+"s",n.style.animationDuration=2+Math.random()*1.5+"s",t.appendChild(n)}for(let a=0;a<40;a++){const n=document.createElement("div");n.className="confetti secondary";const r=Math.random()*Math.PI*2,i=150+Math.random()*200,g=e[Math.floor(Math.random()*e.length)];n.style.backgroundColor=g,n.style.setProperty("--burst-x",Math.cos(r)*i+"px"),n.style.setProperty("--burst-y",Math.sin(r)*i+"px"),n.style.animationDelay=.1+Math.random()*.2+"s",n.style.animationDuration=2.5+Math.random()*1+"s",t.appendChild(n)}for(let a=0;a<80;a++){const n=document.createElement("div");n.className="spark";const r=Math.random()*Math.PI*2,i=100+Math.random()*250,g=o[Math.floor(Math.random()*o.length)];n.style.backgroundColor=g,n.style.setProperty("--burst-x",Math.cos(r)*i+"px"),n.style.setProperty("--burst-y",Math.sin(r)*i+"px"),n.style.animationDelay=Math.random()*.3+"s",n.style.animationDuration=1.2+Math.random()*1+"s",t.appendChild(n)}setTimeout(()=>{document.body.contains(t)&&document.body.removeChild(t)},3e3)}window.switchToProject=$;window.deleteProjectById=dt;Z();
