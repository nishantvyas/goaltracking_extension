(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))n(r);new MutationObserver(r=>{for(const s of r)if(s.type==="childList")for(const c of s.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&n(c)}).observe(document,{childList:!0,subtree:!0});function a(r){const s={};return r.integrity&&(s.integrity=r.integrity),r.referrerPolicy&&(s.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?s.credentials="include":r.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function n(r){if(r.ep)return;r.ep=!0;const s=a(r);fetch(r.href,s)}})();function b(t,e){const a=t.getTime()-e.getTime();return Math.ceil(a/(1e3*60*60*24))}function X(t,e){const a=t.getTime()-e.getTime();return Math.floor(a/(1e3*60*60))}function Y(t,e){const a=t.getTime()-e.getTime();return Math.floor(a/(1e3*60))}function j(t,e){const a=t.getTime()-e.getTime();return Math.floor(a/1e3)}let i={goal:"",targetDate:null,goalCreatedAt:null,tasks:[],doneTasks:[]};const o={countdown:document.getElementById("countdown"),days:document.getElementById("days"),hours:document.getElementById("hours"),minutes:document.getElementById("minutes"),seconds:document.getElementById("seconds"),goalTitle:document.getElementById("goalTitle"),addTaskBtn:document.getElementById("addTaskBtn"),todoList:document.getElementById("todoList"),doneList:document.getElementById("doneList"),settingsBtn:document.getElementById("settingsBtn"),settingsModal:document.getElementById("settingsModal"),taskModal:document.getElementById("taskModal"),taskInput:document.getElementById("taskInput"),taskDescription:document.getElementById("taskDescription"),saveTaskBtn:document.getElementById("saveTaskBtn"),closeTaskBtn:document.getElementById("closeTaskBtn"),goalInput:document.getElementById("goalInput"),dateInput:document.getElementById("dateInput"),saveSettingsBtn:document.getElementById("saveSettingsBtn"),closeSettingsBtn:document.getElementById("closeSettingsBtn"),listsContainer:document.querySelector(".lists-container"),prevList:document.getElementById("prevList"),nextList:document.getElementById("nextList"),activityMatrix:document.getElementById("activityMatrix"),activityStats:document.getElementById("activityStats"),activityTooltip:document.getElementById("activityTooltip")};let p=null,h=null;async function q(){await _(),K(),w(),st(),G()}function K(){let t=!1;i.doneTasks.forEach(e=>{e.completedAt&&!e.timestampMigrated&&(e.timestampMigrated=!0,t=!0)}),i.tasks.forEach(e=>{(e.createdAt||e.updatedAt)&&!e.timestampMigrated&&(e.timestampMigrated=!0,t=!0)}),t&&(console.log("Marked tasks as migrated to new timezone handling"),f())}function W(){if(!Array.isArray(i.doneTasks)||i.doneTasks.length<=1e3)return;const t=new Date,e=new Date(t.getTime()-90*24*60*60*1e3),n=[...i.doneTasks].sort((d,l)=>new Date(l.completedAt||l.updatedAt||l.createdAt)-new Date(d.completedAt||d.updatedAt||d.createdAt)).slice(0,1e3),r=new Set(n.map(d=>d.id)),s=i.doneTasks.filter(d=>r.has(d.id)?!1:new Date(d.completedAt||d.updatedAt||d.createdAt)>=e),c=[...n,...s];if(c.length<i.doneTasks.length){const d=i.doneTasks.length-c.length;console.log(`Cleaned up ${d} old completed tasks`),i.doneTasks=c,f()}}async function _(){try{const t=await chrome.storage.local.get(["goalState","tasks","doneTasks"]);if(t.goalState){const e=JSON.parse(t.goalState);i={goal:e.goal||"",targetDate:e.targetDate?new Date(e.targetDate):null,goalCreatedAt:e.goalCreatedAt?new Date(e.goalCreatedAt):null,tasks:t.tasks?JSON.parse(t.tasks):[],doneTasks:t.doneTasks?JSON.parse(t.doneTasks):[]}}else{const e=await chrome.storage.sync.get(["goalState","tasks","doneTasks"]);if(e.goalState){const a=JSON.parse(e.goalState);i={goal:a.goal||"",targetDate:a.targetDate?new Date(a.targetDate):null,goalCreatedAt:a.goalCreatedAt?new Date(a.goalCreatedAt):null,tasks:e.tasks?JSON.parse(e.tasks):a.tasks||[],doneTasks:e.doneTasks?JSON.parse(e.doneTasks):a.doneTasks||[]},await f();try{await chrome.storage.sync.remove(["goalState","tasks","doneTasks"]),console.log("Cleared old sync storage data after migration")}catch(n){console.log("Could not clear old sync storage:",n)}}}W()}catch(t){console.error("Error loading state:",t),i={goal:"",targetDate:null,goalCreatedAt:null,tasks:[],doneTasks:[]}}}async function f(){const t={goal:i.goal,targetDate:i.targetDate?i.targetDate.toISOString():null,goalCreatedAt:i.goalCreatedAt?i.goalCreatedAt.toISOString():null};try{await chrome.storage.local.set({goalState:JSON.stringify(t)}),await chrome.storage.local.set({tasks:JSON.stringify(i.tasks)}),await chrome.storage.local.set({doneTasks:JSON.stringify(i.doneTasks)});try{await chrome.storage.sync.set({goalSettings:JSON.stringify(t)})}catch{console.log("Sync storage backup skipped (quota limit)")}}catch(e){throw console.error("Error saving to local storage:",e),e}}function w(){i.goal&&i.targetDate?(z(),o.goalTitle.textContent=`${i.goal}`,T()):(o.goalTitle.textContent="Click to set your goal...",N()),v(),L()}function z(){if(!i.targetDate)return"--";const t=new Date,e=new Date(i.targetDate);return Math.max(0,b(e,t))}function N(){o.days.textContent="--",o.hours.textContent="--",o.minutes.textContent="--",o.seconds.textContent="--"}function T(){if(!i.targetDate)return;const t=new Date,e=new Date(i.targetDate);if(t>=e){N();return}const a=b(e,t),n=X(e,t)%24,r=Y(e,t)%60,s=j(e,t)%60;o.days.textContent=String(a).padStart(2,"0"),o.hours.textContent=String(n).padStart(2,"0"),o.minutes.textContent=String(r).padStart(2,"0"),o.seconds.textContent=String(s).padStart(2,"0")}function G(){T(),setInterval(T,1e3)}function Q(t,e=""){return{title:t,description:e,createdAt:Date.now(),updatedAt:Date.now()}}function $(t,e){return{...t,...e,updatedAt:Date.now()}}function A(t){return[...t].sort((e,a)=>a.updatedAt-e.updatedAt)}function C(t,e,a){const n=document.createElement("div");n.className="task-item",n.draggable=!0,n.dataset.index=e,n.dataset.list=a?"done":"todo";const r=document.createElement("h3");if(r.textContent=t.title,n.appendChild(r),t.description){const d=document.createElement("p");d.textContent=t.description,n.appendChild(d)}const s=document.createElement("div");s.className="task-time";const c=V(t.updatedAt);return s.textContent=`Updated ${c}`,n.appendChild(s),n.addEventListener("dragstart",tt),n.addEventListener("click",()=>H(t,e,a)),n}function V(t){const e=new Date(t),a=new Date,n=e.toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0}),r=e.toLocaleDateString("en-US",{month:"short",day:"numeric",year:e.getFullYear()!==a.getFullYear()?"numeric":void 0}),s=m(a),c=m(e),d=new Date(a);d.setDate(d.getDate()-1);const l=m(d);return c===s?`Today at ${n}`:c===l?`Yesterday at ${n}`:`${r} at ${n}`}function v(){if(!o.todoList||!o.doneList)return;o.todoList.innerHTML="",o.doneList.innerHTML="";const t=A(i.tasks),e=A(i.doneTasks);t.forEach(a=>{const n=i.tasks.findIndex(s=>s===a),r=C(a,n,!1);o.todoList.appendChild(r)}),e.forEach(a=>{const n=i.doneTasks.findIndex(s=>s===a),r=C(a,n,!0);o.doneList.appendChild(r)})}function H(t=null,e=null,a=!1){p=e,h=a?"done":"todo",t?(o.taskInput.value=t.title,o.taskDescription.value=t.description||""):(o.taskInput.value="",o.taskDescription.value=""),o.taskModal.classList.add("show"),setTimeout(()=>o.taskInput.focus(),100)}function Z(t){t.key==="Enter"&&!t.shiftKey?(t.preventDefault(),J()):t.key==="Escape"&&(t.preventDefault(),k())}function J(){const t=o.taskInput.value.trim(),e=o.taskDescription.value.trim();if(t){if(p!==null){const a=h==="done"?i.doneTasks:i.tasks,n=a[p];a[p]=$(n,{title:t,description:e})}else i.tasks.push(Q(t,e));f(),v(),k()}}function k(){o.taskModal.classList.remove("show"),p=null,h=null}function tt(t){t.target.classList.add("dragging"),t.dataTransfer.setData("text/plain",JSON.stringify({index:t.target.dataset.index,list:t.target.dataset.list}))}function x(t){t.preventDefault();const e=t.target.closest(".task-list");e&&e.classList.add("drag-over")}function B(t){const e=t.target.closest(".task-list");e&&!e.contains(t.relatedTarget)&&e.classList.remove("drag-over")}function M(t){t.preventDefault();const e=t.target.closest(".task-list");if(!e)return;e.classList.remove("drag-over");const a=JSON.parse(t.dataTransfer.getData("text/plain")),n=a.list==="todo"?i.tasks:i.doneTasks,r=e.id==="todoList"?i.tasks:i.doneTasks;if(n===r)return;const s=n[a.index];s&&(e.id==="doneList"?(s.completedAt=Date.now(),s.updatedAt=Date.now()):e.id==="todoList"&&(delete s.completedAt,s.updatedAt=Date.now()),n.splice(a.index,1),r.push(s),f(),v(),L())}function O(){i.goal&&(o.goalInput.value=i.goal),i.targetDate&&(o.dateInput.value=new Date(i.targetDate).toISOString().slice(0,16)),o.settingsModal.classList.add("show")}function D(){o.settingsModal.classList.remove("show")}function et(){const t=o.goalInput.value.trim(),e=o.dateInput.value;t&&e&&((!i.goal||i.goal!==t)&&(i.goalCreatedAt=new Date),i.goal=t,i.targetDate=new Date(e),f(),w(),D())}function at(t,e,a){const n=parseInt(t.dataset.index),r=e==="todo"?i.tasks:i.doneTasks,s=a==="todo"?i.tasks:i.doneTasks,c=r[n];if(c){const d=$(c,{});a==="done"?d.completedAt=Date.now():a==="todo"&&delete d.completedAt,r.splice(n,1),s.push(d),f(),v(),L()}}function nt(){if(!window.matchMedia("(max-width: 768px)").matches)return;const t=document.createElement("div");t.className="task-move-feedback",document.body.appendChild(t);let e=0,a=0;const n=50,r=500;function s(l,u){e=l.touches[0].clientX,a=Date.now(),u.classList.add("being-moved")}function c(l,u){const g=l.changedTouches[0].clientX,P=Date.now()-a,S=g-e;u.classList.remove("being-moved");const U=Math.abs(S)<n&&P<r,R=Math.abs(S)>n;if(U||R){const E=u.closest(".task-list").id==="todoList"?"todo":"done",I=E==="todo"?"done":"todo";t.textContent=`Moving to ${I==="todo"?"To-Do":"Done"}`,t.classList.add("visible"),o.listsContainer.classList.toggle("show-done"),setTimeout(()=>{at(u,E,I),t.classList.remove("visible")},300)}}function d(l,u){const y=l.touches[0].clientX-e;Math.abs(y)>n&&l.preventDefault()}[o.todoList,o.doneList].forEach(l=>{l.addEventListener("touchstart",u=>{const g=u.target.closest(".task-item");g&&s(u,g)},{passive:!1}),l.addEventListener("touchend",u=>{const g=u.target.closest(".task-item");g&&c(u,g)}),l.addEventListener("touchmove",u=>{u.target.closest(".task-item")&&d(u)},{passive:!1})})}function st(){o.addTaskBtn.addEventListener("click",()=>H()),o.saveTaskBtn.addEventListener("click",J),o.closeTaskBtn.addEventListener("click",k),o.settingsBtn.addEventListener("click",O),o.closeSettingsBtn.addEventListener("click",D),o.saveSettingsBtn.addEventListener("click",et),o.nextList.addEventListener("click",()=>{o.listsContainer.classList.add("show-done")}),o.prevList.addEventListener("click",()=>{o.listsContainer.classList.remove("show-done")}),o.taskInput.addEventListener("keydown",Z),o.taskDescription.addEventListener("keydown",n=>{n.key==="Escape"&&(n.preventDefault(),k())}),nt(),window.matchMedia("(max-width: 768px)").matches||(o.todoList.addEventListener("dragover",x),o.todoList.addEventListener("dragleave",B),o.todoList.addEventListener("drop",M),o.doneList.addEventListener("dragover",x),o.doneList.addEventListener("dragleave",B),o.doneList.addEventListener("drop",M)),o.goalTitle.addEventListener("click",O),window.addEventListener("click",n=>{n.target===o.taskModal&&k(),n.target===o.settingsModal&&D()});const t=document.getElementById("exportBtn");t&&t.addEventListener("click",ft);const e=document.getElementById("importBtn"),a=document.getElementById("importInput");e&&a&&(e.addEventListener("click",()=>a.click()),a.addEventListener("change",n=>{n.target.files.length>0&&pt(n.target.files[0])}))}function L(){if(!o.activityMatrix||!i.goalCreatedAt)return;const t=ot();ct(t),gt(t)}function ot(){const t=it(),e=[];if(!i.goalCreatedAt||!i.targetDate)return e;const a=new Date;a.setHours(23,59,59,999);const n=new Date(i.targetDate);n.setHours(23,59,59,999);const r=n>a?n:a,s=new Date(t);for(;s<=r;){const c=m(s),d=rt(c),l=m(new Date)===c,u=s>new Date;e.push({date:new Date(s),dateStr:c,count:d,level:u&&!l?-1:dt(d),dayOfWeek:s.getDay(),isToday:l,isFuture:u&&!l}),s.setDate(s.getDate()+1)}return e}function it(){let t=i.goalCreatedAt?new Date(i.goalCreatedAt):new Date;const e=[...i.tasks,...i.doneTasks];if(e.length>0){const a=Math.min(...e.map(r=>r.createdAt||Date.now())),n=new Date(a);n<t&&(t=n)}return t.setHours(0,0,0,0),t}function m(t){const e=t.getFullYear(),a=String(t.getMonth()+1).padStart(2,"0"),n=String(t.getDate()).padStart(2,"0");return`${e}-${a}-${n}`}function rt(t){return i.doneTasks.filter(e=>{if(!e.completedAt)return!1;const a=new Date(e.completedAt);return m(a)===t}).length}function dt(t){return t===0?0:t<=2?1:t<=4?2:t<=6?3:4}function ct(t){o.activityMatrix.innerHTML="",t.forEach(e=>{const a=document.createElement("div");let n="matrix-day";e.level===-1?n+=" matrix-day-future":n+=` matrix-day-${e.level}`,e.isToday&&(n+=" matrix-day-today"),a.className=n,a.dataset.date=e.dateStr,a.dataset.count=e.count,a.addEventListener("mouseenter",lt),a.addEventListener("mouseleave",ut),a.addEventListener("mousemove",F),o.activityMatrix.appendChild(a)})}function lt(t){const e=t.target,a=e.dataset.date,n=parseInt(e.dataset.count),s=m(new Date),c=a===s,d=new Date(a+"T00:00:00"),l=a>s,u=d.toLocaleDateString("en-US",{weekday:"short",month:"short",day:"numeric",year:"numeric"});let g;l&&!c?g=`No activity yet on ${u}`:c?g=`${n} ${n===1?"task":"tasks"} completed today`:g=`${n} ${n===1?"task":"tasks"} completed on ${u}`,o.activityTooltip.textContent=g,o.activityTooltip.classList.add("visible"),F(t)}function ut(){o.activityTooltip.classList.remove("visible")}function F(t){const e=o.activityTooltip.getBoundingClientRect();let a=t.clientY+20,n=t.clientX+10;n+e.width>window.innerWidth-8&&(n=t.clientX-e.width-10),a+e.height>window.innerHeight-8&&(a=t.clientY-e.height-10),o.activityTooltip.style.position="fixed",o.activityTooltip.style.top=`${a}px`,o.activityTooltip.style.left=`${n}px`}function gt(t){if(!o.activityStats)return;const a=t.filter(s=>!s.isFuture).filter(s=>s.count>0).length,n=t.reduce((s,c)=>s+c.count,0),r=mt(t);o.activityStats.textContent=`${n} tasks completed across ${a} days (${r} day streak)`}function mt(t){let e=0;const a=new Date;a.setHours(0,0,0,0);const n=m(a);let r=-1;for(let s=t.length-1;s>=0;s--)if(t[s].dateStr===n){r=s;break}if(r===-1){for(let s=t.length-1;s>=0;s--)if(!t[s].isFuture&&t[s].count>0)e++;else if(!t[s].isFuture)break;return e}for(let s=r;s>=0&&t[s].count>0;s--)e++;return e}function ft(){const t={version:"1.0",exportDate:new Date().toISOString(),data:{goal:i.goal,targetDate:i.targetDate?i.targetDate.toISOString():null,goalCreatedAt:i.goalCreatedAt?i.goalCreatedAt.toISOString():null,tasks:i.tasks,doneTasks:i.doneTasks}},e=new Blob([JSON.stringify(t,null,2)],{type:"application/json"}),a=URL.createObjectURL(e),n=document.createElement("a");n.href=a,n.download=`launch-ext-backup-${m(new Date)}.json`,document.body.appendChild(n),n.click(),document.body.removeChild(n),URL.revokeObjectURL(a)}async function pt(t){try{const e=await t.text(),a=JSON.parse(e);if(!a.version||!a.data)throw new Error("Invalid backup file format");i={goal:a.data.goal||"",targetDate:a.data.targetDate?new Date(a.data.targetDate):null,goalCreatedAt:a.data.goalCreatedAt?new Date(a.data.goalCreatedAt):null,tasks:Array.isArray(a.data.tasks)?a.data.tasks:[],doneTasks:Array.isArray(a.data.doneTasks)?a.data.doneTasks:[]},await f(),w(),D(),alert("Data imported successfully!")}catch(e){console.error("Import error:",e),alert("Error importing data. Please make sure the file is a valid backup file.")}}q();
