(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))n(r);new MutationObserver(r=>{for(const o of r)if(o.type==="childList")for(const d of o.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&n(d)}).observe(document,{childList:!0,subtree:!0});function a(r){const o={};return r.integrity&&(o.integrity=r.integrity),r.referrerPolicy&&(o.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?o.credentials="include":r.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function n(r){if(r.ep)return;r.ep=!0;const o=a(r);fetch(r.href,o)}})();function b(t,e){const a=t.getTime()-e.getTime();return Math.ceil(a/(1e3*60*60*24))}function R(t,e){const a=t.getTime()-e.getTime();return Math.floor(a/(1e3*60*60))}function Y(t,e){const a=t.getTime()-e.getTime();return Math.floor(a/(1e3*60))}function j(t,e){const a=t.getTime()-e.getTime();return Math.floor(a/1e3)}let i={goal:"",targetDate:null,goalCreatedAt:null,tasks:[],doneTasks:[]};const s={countdown:document.getElementById("countdown"),days:document.getElementById("days"),hours:document.getElementById("hours"),minutes:document.getElementById("minutes"),seconds:document.getElementById("seconds"),goalTitle:document.getElementById("goalTitle"),addTaskBtn:document.getElementById("addTaskBtn"),todoList:document.getElementById("todoList"),doneList:document.getElementById("doneList"),settingsBtn:document.getElementById("settingsBtn"),settingsModal:document.getElementById("settingsModal"),taskModal:document.getElementById("taskModal"),taskInput:document.getElementById("taskInput"),taskDescription:document.getElementById("taskDescription"),saveTaskBtn:document.getElementById("saveTaskBtn"),closeTaskBtn:document.getElementById("closeTaskBtn"),goalInput:document.getElementById("goalInput"),dateInput:document.getElementById("dateInput"),saveSettingsBtn:document.getElementById("saveSettingsBtn"),closeSettingsBtn:document.getElementById("closeSettingsBtn"),listsContainer:document.querySelector(".lists-container"),prevList:document.getElementById("prevList"),nextList:document.getElementById("nextList"),activityMatrix:document.getElementById("activityMatrix"),activityStats:document.getElementById("activityStats"),activityTooltip:document.getElementById("activityTooltip")};let p=null,h=null;async function K(){await q(),W(),L(),nt(),z()}function W(){let t=!1;i.doneTasks.forEach(e=>{e.completedAt&&!e.timestampMigrated&&(e.timestampMigrated=!0,t=!0)}),i.tasks.forEach(e=>{(e.createdAt||e.updatedAt)&&!e.timestampMigrated&&(e.timestampMigrated=!0,t=!0)}),t&&(console.log("Marked tasks as migrated to new timezone handling"),m())}async function q(){try{const t=await chrome.storage.sync.get(["goalState","tasks","doneTasks"]);if(t.goalState&&t.tasks&&t.doneTasks){const e=JSON.parse(t.goalState);i={goal:e.goal||"",targetDate:e.targetDate?new Date(e.targetDate):null,goalCreatedAt:e.goalCreatedAt?new Date(e.goalCreatedAt):null,tasks:JSON.parse(t.tasks),doneTasks:JSON.parse(t.doneTasks)}}else if(t.goalState){const e=JSON.parse(t.goalState);i={goal:e.goal||"",targetDate:e.targetDate?new Date(e.targetDate):null,goalCreatedAt:e.goalCreatedAt?new Date(e.goalCreatedAt):null,tasks:Array.isArray(e.tasks)?e.tasks:[],doneTasks:Array.isArray(e.doneTasks)?e.doneTasks:[]},await m()}else{const e=await chrome.storage.local.get(["goalState","tasks","doneTasks"]);if(e.goalState&&e.tasks&&e.doneTasks){const a=JSON.parse(e.goalState);i={goal:a.goal||"",targetDate:a.targetDate?new Date(a.targetDate):null,goalCreatedAt:a.goalCreatedAt?new Date(a.goalCreatedAt):null,tasks:JSON.parse(e.tasks),doneTasks:JSON.parse(e.doneTasks)}}}}catch(t){console.error("Error loading state:",t),i={goal:"",targetDate:null,goalCreatedAt:null,tasks:[],doneTasks:[]}}}async function m(){try{const t={goal:i.goal,targetDate:i.targetDate?i.targetDate.toISOString():null,goalCreatedAt:i.goalCreatedAt?i.goalCreatedAt.toISOString():null},e={goalState:JSON.stringify(t),tasks:JSON.stringify(i.tasks),doneTasks:JSON.stringify(i.doneTasks)};await chrome.storage.sync.set(e)}catch(t){console.error("Error saving state:",t);try{await chrome.storage.local.set({goalState:JSON.stringify(saveData),tasks:JSON.stringify(i.tasks),doneTasks:JSON.stringify(i.doneTasks)})}catch(e){console.error("Error saving to local storage:",e)}}}function L(){i.goal&&i.targetDate?(_(),s.goalTitle.textContent=`${i.goal}`,T()):(s.goalTitle.textContent="Click to set your goal...",N()),D(),S()}function _(){if(!i.targetDate)return"--";const t=new Date,e=new Date(i.targetDate);return Math.max(0,b(e,t))}function N(){s.days.textContent="--",s.hours.textContent="--",s.minutes.textContent="--",s.seconds.textContent="--"}function T(){if(!i.targetDate)return;const t=new Date,e=new Date(i.targetDate);if(t>=e){N();return}const a=b(e,t),n=R(e,t)%24,r=Y(e,t)%60,o=j(e,t)%60;s.days.textContent=String(a).padStart(2,"0"),s.hours.textContent=String(n).padStart(2,"0"),s.minutes.textContent=String(r).padStart(2,"0"),s.seconds.textContent=String(o).padStart(2,"0")}function z(){T(),setInterval(T,1e3)}function G(t,e=""){return{title:t,description:e,createdAt:Date.now(),updatedAt:Date.now()}}function $(t,e){return{...t,...e,updatedAt:Date.now()}}function C(t){return[...t].sort((e,a)=>a.updatedAt-e.updatedAt)}function A(t,e,a){const n=document.createElement("div");n.className="task-item",n.draggable=!0,n.dataset.index=e,n.dataset.list=a?"done":"todo";const r=document.createElement("h3");if(r.textContent=t.title,n.appendChild(r),t.description){const u=document.createElement("p");u.textContent=t.description,n.appendChild(u)}const o=document.createElement("div");o.className="task-time";const d=Q(t.updatedAt);return o.textContent=`Updated ${d}`,n.appendChild(o),n.addEventListener("dragstart",Z),n.addEventListener("click",()=>J(t,e,a)),n}function Q(t){const e=new Date(t),a=new Date,n=e.toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0}),r=e.toLocaleDateString("en-US",{month:"short",day:"numeric",year:e.getFullYear()!==a.getFullYear()?"numeric":void 0}),o=f(a),d=f(e),u=new Date(a);u.setDate(u.getDate()-1);const l=f(u);return d===o?`Today at ${n}`:d===l?`Yesterday at ${n}`:`${r} at ${n}`}function D(){if(!s.todoList||!s.doneList)return;s.todoList.innerHTML="",s.doneList.innerHTML="";const t=C(i.tasks),e=C(i.doneTasks);t.forEach(a=>{const n=i.tasks.findIndex(o=>o===a),r=A(a,n,!1);s.todoList.appendChild(r)}),e.forEach(a=>{const n=i.doneTasks.findIndex(o=>o===a),r=A(a,n,!0);s.doneList.appendChild(r)})}function J(t=null,e=null,a=!1){p=e,h=a?"done":"todo",t?(s.taskInput.value=t.title,s.taskDescription.value=t.description||""):(s.taskInput.value="",s.taskDescription.value=""),s.taskModal.classList.add("show"),setTimeout(()=>s.taskInput.focus(),100)}function V(t){t.key==="Enter"&&!t.shiftKey?(t.preventDefault(),H()):t.key==="Escape"&&(t.preventDefault(),k())}function H(){const t=s.taskInput.value.trim(),e=s.taskDescription.value.trim();if(t){if(p!==null){const a=h==="done"?i.doneTasks:i.tasks,n=a[p];a[p]=$(n,{title:t,description:e})}else i.tasks.push(G(t,e));m(),D(),k()}}function k(){s.taskModal.classList.remove("show"),p=null,h=null}function Z(t){t.target.classList.add("dragging"),t.dataTransfer.setData("text/plain",JSON.stringify({index:t.target.dataset.index,list:t.target.dataset.list}))}function x(t){t.preventDefault();const e=t.target.closest(".task-list");e&&e.classList.add("drag-over")}function B(t){const e=t.target.closest(".task-list");e&&!e.contains(t.relatedTarget)&&e.classList.remove("drag-over")}function M(t){t.preventDefault();const e=t.target.closest(".task-list");if(!e)return;e.classList.remove("drag-over");const a=JSON.parse(t.dataTransfer.getData("text/plain")),n=a.list==="todo"?i.tasks:i.doneTasks,r=e.id==="todoList"?i.tasks:i.doneTasks;if(n===r)return;const o=n[a.index];o&&(e.id==="doneList"?(o.completedAt=Date.now(),o.updatedAt=Date.now()):e.id==="todoList"&&(delete o.completedAt,o.updatedAt=Date.now()),n.splice(a.index,1),r.push(o),m(),D(),S())}function O(){i.goal&&(s.goalInput.value=i.goal),i.targetDate&&(s.dateInput.value=new Date(i.targetDate).toISOString().slice(0,16)),s.settingsModal.classList.add("show")}function v(){s.settingsModal.classList.remove("show")}function tt(){const t=s.goalInput.value.trim(),e=s.dateInput.value;t&&e&&((!i.goal||i.goal!==t)&&(i.goalCreatedAt=new Date),i.goal=t,i.targetDate=new Date(e),m(),L(),v())}function et(t,e,a){const n=parseInt(t.dataset.index),r=e==="todo"?i.tasks:i.doneTasks,o=a==="todo"?i.tasks:i.doneTasks,d=r[n];if(d){const u=$(d,{});a==="done"?u.completedAt=Date.now():a==="todo"&&delete u.completedAt,r.splice(n,1),o.push(u),m(),D(),S()}}function at(){if(!window.matchMedia("(max-width: 768px)").matches)return;const t=document.createElement("div");t.className="task-move-feedback",document.body.appendChild(t);let e=0,a=0;const n=50,r=500;function o(l,c){e=l.touches[0].clientX,a=Date.now(),c.classList.add("being-moved")}function d(l,c){const g=l.changedTouches[0].clientX,P=Date.now()-a,w=g-e;c.classList.remove("being-moved");const U=Math.abs(w)<n&&P<r,X=Math.abs(w)>n;if(U||X){const E=c.closest(".task-list").id==="todoList"?"todo":"done",I=E==="todo"?"done":"todo";t.textContent=`Moving to ${I==="todo"?"To-Do":"Done"}`,t.classList.add("visible"),s.listsContainer.classList.toggle("show-done"),setTimeout(()=>{et(c,E,I),t.classList.remove("visible")},300)}}function u(l,c){const y=l.touches[0].clientX-e;Math.abs(y)>n&&l.preventDefault()}[s.todoList,s.doneList].forEach(l=>{l.addEventListener("touchstart",c=>{const g=c.target.closest(".task-item");g&&o(c,g)},{passive:!1}),l.addEventListener("touchend",c=>{const g=c.target.closest(".task-item");g&&d(c,g)}),l.addEventListener("touchmove",c=>{c.target.closest(".task-item")&&u(c)},{passive:!1})})}function nt(){s.addTaskBtn.addEventListener("click",()=>J()),s.saveTaskBtn.addEventListener("click",H),s.closeTaskBtn.addEventListener("click",k),s.settingsBtn.addEventListener("click",O),s.closeSettingsBtn.addEventListener("click",v),s.saveSettingsBtn.addEventListener("click",tt),s.nextList.addEventListener("click",()=>{s.listsContainer.classList.add("show-done")}),s.prevList.addEventListener("click",()=>{s.listsContainer.classList.remove("show-done")}),s.taskInput.addEventListener("keydown",V),s.taskDescription.addEventListener("keydown",n=>{n.key==="Escape"&&(n.preventDefault(),k())}),at(),window.matchMedia("(max-width: 768px)").matches||(s.todoList.addEventListener("dragover",x),s.todoList.addEventListener("dragleave",B),s.todoList.addEventListener("drop",M),s.doneList.addEventListener("dragover",x),s.doneList.addEventListener("dragleave",B),s.doneList.addEventListener("drop",M)),s.goalTitle.addEventListener("click",O),window.addEventListener("click",n=>{n.target===s.taskModal&&k(),n.target===s.settingsModal&&v()});const t=document.getElementById("exportBtn");t&&t.addEventListener("click",ft);const e=document.getElementById("importBtn"),a=document.getElementById("importInput");e&&a&&(e.addEventListener("click",()=>a.click()),a.addEventListener("change",n=>{n.target.files.length>0&&mt(n.target.files[0])}))}function S(){if(!s.activityMatrix||!i.goalCreatedAt)return;const t=st();dt(t),ut(t)}function st(){const t=ot(),e=[];if(!i.goalCreatedAt||!i.targetDate)return e;const a=new Date;a.setHours(23,59,59,999);const n=new Date(i.targetDate);n.setHours(23,59,59,999);const r=n>a?n:a,o=new Date(t);for(;o<=r;){const d=f(o),u=it(d),l=f(new Date)===d,c=o>new Date;e.push({date:new Date(o),dateStr:d,count:u,level:c&&!l?-1:rt(u),dayOfWeek:o.getDay(),isToday:l,isFuture:c&&!l}),o.setDate(o.getDate()+1)}return e}function ot(){let t=i.goalCreatedAt?new Date(i.goalCreatedAt):new Date;const e=[...i.tasks,...i.doneTasks];if(e.length>0){const a=Math.min(...e.map(r=>r.createdAt||Date.now())),n=new Date(a);n<t&&(t=n)}return t.setHours(0,0,0,0),t}function f(t){const e=t.getFullYear(),a=String(t.getMonth()+1).padStart(2,"0"),n=String(t.getDate()).padStart(2,"0");return`${e}-${a}-${n}`}function it(t){return i.doneTasks.filter(e=>{if(!e.completedAt)return!1;const a=new Date(e.completedAt);return f(a)===t}).length}function rt(t){return t===0?0:t<=2?1:t<=4?2:t<=6?3:4}function dt(t){s.activityMatrix.innerHTML="",t.forEach(e=>{const a=document.createElement("div");let n="matrix-day";e.level===-1?n+=" matrix-day-future":n+=` matrix-day-${e.level}`,e.isToday&&(n+=" matrix-day-today"),a.className=n,a.dataset.date=e.dateStr,a.dataset.count=e.count,a.addEventListener("mouseenter",ct),a.addEventListener("mouseleave",lt),a.addEventListener("mousemove",F),s.activityMatrix.appendChild(a)})}function ct(t){const e=t.target,a=e.dataset.date,n=parseInt(e.dataset.count),o=f(new Date),d=a===o,u=new Date(a+"T00:00:00"),l=a>o,c=u.toLocaleDateString("en-US",{weekday:"short",month:"short",day:"numeric",year:"numeric"});let g;l&&!d?g=`No activity yet on ${c}`:d?g=`${n} ${n===1?"task":"tasks"} completed today`:g=`${n} ${n===1?"task":"tasks"} completed on ${c}`,s.activityTooltip.textContent=g,s.activityTooltip.classList.add("visible"),F(t)}function lt(){s.activityTooltip.classList.remove("visible")}function F(t){const e=s.activityTooltip.getBoundingClientRect();let a=t.clientY+20,n=t.clientX+10;n+e.width>window.innerWidth-8&&(n=t.clientX-e.width-10),a+e.height>window.innerHeight-8&&(a=t.clientY-e.height-10),s.activityTooltip.style.position="fixed",s.activityTooltip.style.top=`${a}px`,s.activityTooltip.style.left=`${n}px`}function ut(t){if(!s.activityStats)return;const a=t.filter(o=>!o.isFuture).filter(o=>o.count>0).length,n=t.reduce((o,d)=>o+d.count,0),r=gt(t);s.activityStats.textContent=`${n} tasks completed across ${a} days (${r} day streak)`}function gt(t){let e=0;const a=new Date;a.setHours(0,0,0,0);const n=f(a);let r=-1;for(let o=t.length-1;o>=0;o--)if(t[o].dateStr===n){r=o;break}if(r===-1){for(let o=t.length-1;o>=0;o--)if(!t[o].isFuture&&t[o].count>0)e++;else if(!t[o].isFuture)break;return e}for(let o=r;o>=0&&t[o].count>0;o--)e++;return e}function ft(){const t={version:"1.0",exportDate:new Date().toISOString(),data:{goal:i.goal,targetDate:i.targetDate?i.targetDate.toISOString():null,goalCreatedAt:i.goalCreatedAt?i.goalCreatedAt.toISOString():null,tasks:i.tasks,doneTasks:i.doneTasks}},e=new Blob([JSON.stringify(t,null,2)],{type:"application/json"}),a=URL.createObjectURL(e),n=document.createElement("a");n.href=a,n.download=`launch-ext-backup-${f(new Date)}.json`,document.body.appendChild(n),n.click(),document.body.removeChild(n),URL.revokeObjectURL(a)}async function mt(t){try{const e=await t.text(),a=JSON.parse(e);if(!a.version||!a.data)throw new Error("Invalid backup file format");i={goal:a.data.goal||"",targetDate:a.data.targetDate?new Date(a.data.targetDate):null,goalCreatedAt:a.data.goalCreatedAt?new Date(a.data.goalCreatedAt):null,tasks:Array.isArray(a.data.tasks)?a.data.tasks:[],doneTasks:Array.isArray(a.data.doneTasks)?a.data.doneTasks:[]},await m(),L(),v(),alert("Data imported successfully!")}catch(e){console.error("Import error:",e),alert("Error importing data. Please make sure the file is a valid backup file.")}}K();
