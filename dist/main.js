(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))a(i);new MutationObserver(i=>{for(const r of i)if(r.type==="childList")for(const d of r.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&a(d)}).observe(document,{childList:!0,subtree:!0});function n(i){const r={};return i.integrity&&(r.integrity=i.integrity),i.referrerPolicy&&(r.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?r.credentials="include":i.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function a(i){if(i.ep)return;i.ep=!0;const r=n(i);fetch(i.href,r)}})();function O(t,e){const n=t.getTime()-e.getTime();return Math.ceil(n/(1e3*60*60*24))}function Y(t,e){const n=t.getTime()-e.getTime();return Math.floor(n/(1e3*60*60))}function j(t,e){const n=t.getTime()-e.getTime();return Math.floor(n/(1e3*60))}function F(t,e){const n=t.getTime()-e.getTime();return Math.floor(n/1e3)}let s={goal:"",targetDate:null,goalCreatedAt:null,tasks:[],doneTasks:[]};const o={countdown:document.getElementById("countdown"),days:document.getElementById("days"),hours:document.getElementById("hours"),minutes:document.getElementById("minutes"),seconds:document.getElementById("seconds"),goalTitle:document.getElementById("goalTitle"),addTaskBtn:document.getElementById("addTaskBtn"),todoList:document.getElementById("todoList"),doneList:document.getElementById("doneList"),settingsBtn:document.getElementById("settingsBtn"),settingsModal:document.getElementById("settingsModal"),taskModal:document.getElementById("taskModal"),taskInput:document.getElementById("taskInput"),taskDescription:document.getElementById("taskDescription"),saveTaskBtn:document.getElementById("saveTaskBtn"),closeTaskBtn:document.getElementById("closeTaskBtn"),goalInput:document.getElementById("goalInput"),dateInput:document.getElementById("dateInput"),saveSettingsBtn:document.getElementById("saveSettingsBtn"),closeSettingsBtn:document.getElementById("closeSettingsBtn"),listsContainer:document.querySelector(".lists-container"),prevList:document.getElementById("prevList"),nextList:document.getElementById("nextList"),activityMatrix:document.getElementById("activityMatrix"),activityStats:document.getElementById("activityStats"),activityTooltip:document.getElementById("activityTooltip")};let f=null,D=null;async function K(){await W(),T(),nt(),_()}async function W(){try{const t=await chrome.storage.sync.get(["goalState"]);if(t.goalState){const e=JSON.parse(t.goalState);s={goal:e.goal||"",targetDate:e.targetDate?new Date(e.targetDate):null,goalCreatedAt:e.goalCreatedAt?new Date(e.goalCreatedAt):null,tasks:Array.isArray(e.tasks)?e.tasks:[],doneTasks:Array.isArray(e.doneTasks)?e.doneTasks:[]}}}catch(t){console.error("Error loading state:",t),s={goal:"",targetDate:null,goalCreatedAt:null,tasks:[],doneTasks:[]}}}async function p(){try{const t={...s,targetDate:s.targetDate?s.targetDate.toISOString():null,goalCreatedAt:s.goalCreatedAt?s.goalCreatedAt.toISOString():null};await chrome.storage.sync.set({goalState:JSON.stringify(t)})}catch(t){console.error("Error saving state:",t)}}function T(){s.goal&&s.targetDate?(q(),o.goalTitle.textContent=`${s.goal}`,h()):(o.goalTitle.textContent="Click to set your goal...",$()),v(),L()}function q(){if(!s.targetDate)return"--";const t=new Date,e=new Date(s.targetDate);return Math.max(0,O(e,t))}function $(){o.days.textContent="--",o.hours.textContent="--",o.minutes.textContent="--",o.seconds.textContent="--"}function h(){if(!s.targetDate)return;const t=new Date,e=new Date(s.targetDate);if(t>=e){$();return}const n=O(e,t),a=Y(e,t)%24,i=j(e,t)%60,r=F(e,t)%60;o.days.textContent=String(n).padStart(2,"0"),o.hours.textContent=String(a).padStart(2,"0"),o.minutes.textContent=String(i).padStart(2,"0"),o.seconds.textContent=String(r).padStart(2,"0")}function _(){h(),setInterval(h,1e3)}function G(t,e=""){return{title:t,description:e,createdAt:Date.now(),updatedAt:Date.now()}}function H(t,e){return{...t,...e,updatedAt:Date.now()}}function x(t){return[...t].sort((e,n)=>n.updatedAt-e.updatedAt)}function C(t,e,n){const a=document.createElement("div");a.className="task-item",a.draggable=!0,a.dataset.index=e,a.dataset.list=n?"done":"todo";const i=document.createElement("h3");if(i.textContent=t.title,a.appendChild(i),t.description){const l=document.createElement("p");l.textContent=t.description,a.appendChild(l)}const r=document.createElement("div");r.className="task-time";const d=z(t.updatedAt);return r.textContent=`Updated ${d}`,a.appendChild(r),a.addEventListener("dragstart",V),a.addEventListener("click",()=>N(t,e,n)),a}function z(t){const e=Date.now(),n=new Date(t),a=Math.floor((e-t)/1e3),i=Math.floor(a/60),r=Math.floor(i/60),d=Math.floor(r/24),l=n.toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0}),u=n.toLocaleDateString("en-US",{month:"short",day:"numeric",year:n.getFullYear()!==new Date().getFullYear()?"numeric":void 0});return d===0&&n.getDate()===new Date().getDate()?`Today at ${l}`:d===1||d===0&&n.getDate()===new Date().getDate()-1?`Yesterday at ${l}`:`${u} at ${l}`}function v(){if(!o.todoList||!o.doneList)return;o.todoList.innerHTML="",o.doneList.innerHTML="";const t=x(s.tasks),e=x(s.doneTasks);t.forEach(n=>{const a=s.tasks.findIndex(r=>r===n),i=C(n,a,!1);o.todoList.appendChild(i)}),e.forEach(n=>{const a=s.doneTasks.findIndex(r=>r===n),i=C(n,a,!0);o.doneList.appendChild(i)})}function N(t=null,e=null,n=!1){f=e,D=n?"done":"todo",t?(o.taskInput.value=t.title,o.taskDescription.value=t.description||""):(o.taskInput.value="",o.taskDescription.value=""),o.taskModal.classList.add("show"),setTimeout(()=>o.taskInput.focus(),100)}function Q(t){t.key==="Enter"&&!t.shiftKey?(t.preventDefault(),U()):t.key==="Escape"&&(t.preventDefault(),m())}function U(){const t=o.taskInput.value.trim(),e=o.taskDescription.value.trim();if(t){if(f!==null){const n=D==="done"?s.doneTasks:s.tasks,a=n[f];n[f]=H(a,{title:t,description:e})}else s.tasks.push(G(t,e));p(),v(),m()}}function m(){o.taskModal.classList.remove("show"),f=null,D=null}function V(t){t.target.classList.add("dragging"),t.dataTransfer.setData("text/plain",JSON.stringify({index:t.target.dataset.index,list:t.target.dataset.list}))}function B(t){t.preventDefault();const e=t.target.closest(".task-list");e&&e.classList.add("drag-over")}function A(t){const e=t.target.closest(".task-list");e&&!e.contains(t.relatedTarget)&&e.classList.remove("drag-over")}function M(t){t.preventDefault();const e=t.target.closest(".task-list");if(!e)return;e.classList.remove("drag-over");const n=JSON.parse(t.dataTransfer.getData("text/plain")),a=n.list==="todo"?s.tasks:s.doneTasks,i=e.id==="todoList"?s.tasks:s.doneTasks;if(a===i)return;const r=a[n.index];r&&(e.id==="doneList"?(r.completedAt=Date.now(),r.updatedAt=Date.now()):e.id==="todoList"&&(delete r.completedAt,r.updatedAt=Date.now()),a.splice(n.index,1),i.push(r),p(),v(),L())}function b(){s.goal&&(o.goalInput.value=s.goal),s.targetDate&&(o.dateInput.value=new Date(s.targetDate).toISOString().slice(0,16)),o.settingsModal.classList.add("show")}function k(){o.settingsModal.classList.remove("show")}function Z(){const t=o.goalInput.value.trim(),e=o.dateInput.value;t&&e&&((!s.goal||s.goal!==t)&&(s.goalCreatedAt=new Date),s.goal=t,s.targetDate=new Date(e),p(),T(),k())}function tt(t,e,n){const a=parseInt(t.dataset.index),i=e==="todo"?s.tasks:s.doneTasks,r=n==="todo"?s.tasks:s.doneTasks,d=i[a];if(d){const l=H(d,{});n==="done"?l.completedAt=Date.now():n==="todo"&&delete l.completedAt,i.splice(a,1),r.push(l),p(),v(),L()}}function et(){if(!window.matchMedia("(max-width: 768px)").matches)return;const t=document.createElement("div");t.className="task-move-feedback",document.body.appendChild(t);let e=0,n=0;const a=50,i=500;function r(u,c){e=u.touches[0].clientX,n=Date.now(),c.classList.add("being-moved")}function d(u,c){const g=u.changedTouches[0].clientX,P=Date.now()-n,w=g-e;c.classList.remove("being-moved");const R=Math.abs(w)<a&&P<i,J=Math.abs(w)>a;if(R||J){const S=c.closest(".task-list").id==="todoList"?"todo":"done",I=S==="todo"?"done":"todo";t.textContent=`Moving to ${I==="todo"?"To-Do":"Done"}`,t.classList.add("visible"),o.listsContainer.classList.toggle("show-done"),setTimeout(()=>{tt(c,S,I),t.classList.remove("visible")},300)}}function l(u,c){const E=u.touches[0].clientX-e;Math.abs(E)>a&&u.preventDefault()}[o.todoList,o.doneList].forEach(u=>{u.addEventListener("touchstart",c=>{const g=c.target.closest(".task-item");g&&r(c,g)},{passive:!1}),u.addEventListener("touchend",c=>{const g=c.target.closest(".task-item");g&&d(c,g)}),u.addEventListener("touchmove",c=>{c.target.closest(".task-item")&&l(c)},{passive:!1})})}function nt(){o.addTaskBtn.addEventListener("click",()=>N()),o.saveTaskBtn.addEventListener("click",U),o.closeTaskBtn.addEventListener("click",m),o.settingsBtn.addEventListener("click",b),o.closeSettingsBtn.addEventListener("click",k),o.saveSettingsBtn.addEventListener("click",Z),o.nextList.addEventListener("click",()=>{o.listsContainer.classList.add("show-done")}),o.prevList.addEventListener("click",()=>{o.listsContainer.classList.remove("show-done")}),o.taskInput.addEventListener("keydown",Q),o.taskDescription.addEventListener("keydown",a=>{a.key==="Escape"&&(a.preventDefault(),m())}),et(),window.matchMedia("(max-width: 768px)").matches||(o.todoList.addEventListener("dragover",B),o.todoList.addEventListener("dragleave",A),o.todoList.addEventListener("drop",M),o.doneList.addEventListener("dragover",B),o.doneList.addEventListener("dragleave",A),o.doneList.addEventListener("drop",M)),o.goalTitle.addEventListener("click",b),window.addEventListener("click",a=>{a.target===o.taskModal&&m(),a.target===o.settingsModal&&k()});const t=document.getElementById("exportBtn");t&&t.addEventListener("click",gt);const e=document.getElementById("importBtn"),n=document.getElementById("importInput");e&&n&&(e.addEventListener("click",()=>n.click()),n.addEventListener("change",a=>{a.target.files.length>0&&ft(a.target.files[0])}))}function L(){if(!o.activityMatrix||!s.goalCreatedAt)return;const t=at();rt(t),lt(t)}function at(){const t=ot(),e=new Date;e.setHours(23,59,59,999);const n=[],a=new Date(t);for(;a<=e;){const i=y(a),r=st(i);n.push({date:new Date(a),dateStr:i,count:r,level:it(r),dayOfWeek:a.getDay()}),a.setDate(a.getDate()+1)}return n}function ot(){let t=s.goalCreatedAt?new Date(s.goalCreatedAt):new Date;const e=[...s.tasks,...s.doneTasks];if(e.length>0){const n=Math.min(...e.map(i=>i.createdAt||Date.now())),a=new Date(n);a<t&&(t=a)}return t.setHours(0,0,0,0),t}function y(t){return t.toISOString().split("T")[0]}function st(t){return s.doneTasks.filter(e=>{if(!e.completedAt)return!1;const n=new Date(e.completedAt);return y(n)===t}).length}function it(t){return t===0?0:t<=2?1:t<=4?2:t<=6?3:4}function rt(t){o.activityMatrix.innerHTML="",t.forEach(e=>{const n=document.createElement("div");n.className=`matrix-day matrix-day-${e.level}`,n.dataset.date=e.dateStr,n.dataset.count=e.count,n.addEventListener("mouseenter",dt),n.addEventListener("mouseleave",ct),n.addEventListener("mousemove",X),o.activityMatrix.appendChild(n)})}function dt(t){const e=t.target,n=new Date(e.dataset.date),a=parseInt(e.dataset.count),i=n.toLocaleDateString("en-US",{weekday:"short",month:"short",day:"numeric",year:"numeric"}),d=`${a} ${a===1?"task":"tasks"} completed on ${i}`;o.activityTooltip.textContent=d,o.activityTooltip.classList.add("visible"),X(t)}function ct(){o.activityTooltip.classList.remove("visible")}function X(t){const e=o.activityTooltip.getBoundingClientRect();let n=t.clientY+20,a=t.clientX+10;a+e.width>window.innerWidth-8&&(a=t.clientX-e.width-10),n+e.height>window.innerHeight-8&&(n=t.clientY-e.height-10),o.activityTooltip.style.position="fixed",o.activityTooltip.style.top=`${n}px`,o.activityTooltip.style.left=`${a}px`}function lt(t){if(!o.activityStats)return;t.length;const e=t.filter(i=>i.count>0).length,n=t.reduce((i,r)=>i+r.count,0),a=ut(t);o.activityStats.textContent=`${n} tasks completed across ${e} days (${a} day streak)`}function ut(t){let e=0;const n=new Date;n.setHours(0,0,0,0);const a=y(n);let i=-1;for(let r=t.length-1;r>=0;r--)if(t[r].dateStr===a){i=r;break}if(i===-1)return 0;for(let r=i;r>=0&&t[r].count>0;r--)e++;return e}function gt(){const t={version:"1.0",exportDate:new Date().toISOString(),data:{goal:s.goal,targetDate:s.targetDate?s.targetDate.toISOString():null,goalCreatedAt:s.goalCreatedAt?s.goalCreatedAt.toISOString():null,tasks:s.tasks,doneTasks:s.doneTasks}},e=new Blob([JSON.stringify(t,null,2)],{type:"application/json"}),n=URL.createObjectURL(e),a=document.createElement("a");a.href=n,a.download=`launch-ext-backup-${y(new Date)}.json`,document.body.appendChild(a),a.click(),document.body.removeChild(a),URL.revokeObjectURL(n)}async function ft(t){try{const e=await t.text(),n=JSON.parse(e);if(!n.version||!n.data)throw new Error("Invalid backup file format");s={goal:n.data.goal||"",targetDate:n.data.targetDate?new Date(n.data.targetDate):null,goalCreatedAt:n.data.goalCreatedAt?new Date(n.data.goalCreatedAt):null,tasks:Array.isArray(n.data.tasks)?n.data.tasks:[],doneTasks:Array.isArray(n.data.doneTasks)?n.data.doneTasks:[]},await p(),T(),k(),alert("Data imported successfully!")}catch(e){console.error("Import error:",e),alert("Error importing data. Please make sure the file is a valid backup file.")}}K();
