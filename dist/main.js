(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))a(r);new MutationObserver(r=>{for(const o of r)if(o.type==="childList")for(const d of o.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&a(d)}).observe(document,{childList:!0,subtree:!0});function n(r){const o={};return r.integrity&&(o.integrity=r.integrity),r.referrerPolicy&&(o.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?o.credentials="include":r.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function a(r){if(r.ep)return;r.ep=!0;const o=n(r);fetch(r.href,o)}})();function O(t,e){const n=t.getTime()-e.getTime();return Math.ceil(n/(1e3*60*60*24))}function J(t,e){const n=t.getTime()-e.getTime();return Math.floor(n/(1e3*60*60))}function Y(t,e){const n=t.getTime()-e.getTime();return Math.floor(n/(1e3*60))}function j(t,e){const n=t.getTime()-e.getTime();return Math.floor(n/1e3)}let i={goal:"",targetDate:null,goalCreatedAt:null,tasks:[],doneTasks:[]};const s={countdown:document.getElementById("countdown"),days:document.getElementById("days"),hours:document.getElementById("hours"),minutes:document.getElementById("minutes"),seconds:document.getElementById("seconds"),goalTitle:document.getElementById("goalTitle"),addTaskBtn:document.getElementById("addTaskBtn"),todoList:document.getElementById("todoList"),doneList:document.getElementById("doneList"),settingsBtn:document.getElementById("settingsBtn"),settingsModal:document.getElementById("settingsModal"),taskModal:document.getElementById("taskModal"),taskInput:document.getElementById("taskInput"),taskDescription:document.getElementById("taskDescription"),saveTaskBtn:document.getElementById("saveTaskBtn"),closeTaskBtn:document.getElementById("closeTaskBtn"),goalInput:document.getElementById("goalInput"),dateInput:document.getElementById("dateInput"),saveSettingsBtn:document.getElementById("saveSettingsBtn"),closeSettingsBtn:document.getElementById("closeSettingsBtn"),listsContainer:document.querySelector(".lists-container"),prevList:document.getElementById("prevList"),nextList:document.getElementById("nextList"),activityMatrix:document.getElementById("activityMatrix"),activityStats:document.getElementById("activityStats"),activityTooltip:document.getElementById("activityTooltip")};let p=null,T=null;async function K(){await q(),W(),L(),at(),z()}function W(){let t=!1;i.doneTasks.forEach(e=>{e.completedAt&&!e.timestampMigrated&&(e.timestampMigrated=!0,t=!0)}),i.tasks.forEach(e=>{(e.createdAt||e.updatedAt)&&!e.timestampMigrated&&(e.timestampMigrated=!0,t=!0)}),t&&(console.log("Marked tasks as migrated to new timezone handling"),m())}async function q(){try{const t=await chrome.storage.sync.get(["goalState"]);if(t.goalState){const e=JSON.parse(t.goalState);i={goal:e.goal||"",targetDate:e.targetDate?new Date(e.targetDate):null,goalCreatedAt:e.goalCreatedAt?new Date(e.goalCreatedAt):null,tasks:Array.isArray(e.tasks)?e.tasks:[],doneTasks:Array.isArray(e.doneTasks)?e.doneTasks:[]}}}catch(t){console.error("Error loading state:",t),i={goal:"",targetDate:null,goalCreatedAt:null,tasks:[],doneTasks:[]}}}async function m(){try{const t={...i,targetDate:i.targetDate?i.targetDate.toISOString():null,goalCreatedAt:i.goalCreatedAt?i.goalCreatedAt.toISOString():null};await chrome.storage.sync.set({goalState:JSON.stringify(t)})}catch(t){console.error("Error saving state:",t)}}function L(){i.goal&&i.targetDate?(_(),s.goalTitle.textContent=`${i.goal}`,h()):(s.goalTitle.textContent="Click to set your goal...",$()),D(),E()}function _(){if(!i.targetDate)return"--";const t=new Date,e=new Date(i.targetDate);return Math.max(0,O(e,t))}function $(){s.days.textContent="--",s.hours.textContent="--",s.minutes.textContent="--",s.seconds.textContent="--"}function h(){if(!i.targetDate)return;const t=new Date,e=new Date(i.targetDate);if(t>=e){$();return}const n=O(e,t),a=J(e,t)%24,r=Y(e,t)%60,o=j(e,t)%60;s.days.textContent=String(n).padStart(2,"0"),s.hours.textContent=String(a).padStart(2,"0"),s.minutes.textContent=String(r).padStart(2,"0"),s.seconds.textContent=String(o).padStart(2,"0")}function z(){h(),setInterval(h,1e3)}function G(t,e=""){return{title:t,description:e,createdAt:Date.now(),updatedAt:Date.now()}}function N(t,e){return{...t,...e,updatedAt:Date.now()}}function x(t){return[...t].sort((e,n)=>n.updatedAt-e.updatedAt)}function C(t,e,n){const a=document.createElement("div");a.className="task-item",a.draggable=!0,a.dataset.index=e,a.dataset.list=n?"done":"todo";const r=document.createElement("h3");if(r.textContent=t.title,a.appendChild(r),t.description){const u=document.createElement("p");u.textContent=t.description,a.appendChild(u)}const o=document.createElement("div");o.className="task-time";const d=Q(t.updatedAt);return o.textContent=`Updated ${d}`,a.appendChild(o),a.addEventListener("dragstart",Z),a.addEventListener("click",()=>H(t,e,n)),a}function Q(t){const e=new Date(t),n=new Date,a=e.toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0}),r=e.toLocaleDateString("en-US",{month:"short",day:"numeric",year:e.getFullYear()!==n.getFullYear()?"numeric":void 0}),o=f(n),d=f(e),u=new Date(n);u.setDate(u.getDate()-1);const l=f(u);return d===o?`Today at ${a}`:d===l?`Yesterday at ${a}`:`${r} at ${a}`}function D(){if(!s.todoList||!s.doneList)return;s.todoList.innerHTML="",s.doneList.innerHTML="";const t=x(i.tasks),e=x(i.doneTasks);t.forEach(n=>{const a=i.tasks.findIndex(o=>o===n),r=C(n,a,!1);s.todoList.appendChild(r)}),e.forEach(n=>{const a=i.doneTasks.findIndex(o=>o===n),r=C(n,a,!0);s.doneList.appendChild(r)})}function H(t=null,e=null,n=!1){p=e,T=n?"done":"todo",t?(s.taskInput.value=t.title,s.taskDescription.value=t.description||""):(s.taskInput.value="",s.taskDescription.value=""),s.taskModal.classList.add("show"),setTimeout(()=>s.taskInput.focus(),100)}function V(t){t.key==="Enter"&&!t.shiftKey?(t.preventDefault(),F()):t.key==="Escape"&&(t.preventDefault(),y())}function F(){const t=s.taskInput.value.trim(),e=s.taskDescription.value.trim();if(t){if(p!==null){const n=T==="done"?i.doneTasks:i.tasks,a=n[p];n[p]=N(a,{title:t,description:e})}else i.tasks.push(G(t,e));m(),D(),y()}}function y(){s.taskModal.classList.remove("show"),p=null,T=null}function Z(t){t.target.classList.add("dragging"),t.dataTransfer.setData("text/plain",JSON.stringify({index:t.target.dataset.index,list:t.target.dataset.list}))}function A(t){t.preventDefault();const e=t.target.closest(".task-list");e&&e.classList.add("drag-over")}function B(t){const e=t.target.closest(".task-list");e&&!e.contains(t.relatedTarget)&&e.classList.remove("drag-over")}function M(t){t.preventDefault();const e=t.target.closest(".task-list");if(!e)return;e.classList.remove("drag-over");const n=JSON.parse(t.dataTransfer.getData("text/plain")),a=n.list==="todo"?i.tasks:i.doneTasks,r=e.id==="todoList"?i.tasks:i.doneTasks;if(a===r)return;const o=a[n.index];o&&(e.id==="doneList"?(o.completedAt=Date.now(),o.updatedAt=Date.now()):e.id==="todoList"&&(delete o.completedAt,o.updatedAt=Date.now()),a.splice(n.index,1),r.push(o),m(),D(),E())}function b(){i.goal&&(s.goalInput.value=i.goal),i.targetDate&&(s.dateInput.value=new Date(i.targetDate).toISOString().slice(0,16)),s.settingsModal.classList.add("show")}function v(){s.settingsModal.classList.remove("show")}function tt(){const t=s.goalInput.value.trim(),e=s.dateInput.value;t&&e&&((!i.goal||i.goal!==t)&&(i.goalCreatedAt=new Date),i.goal=t,i.targetDate=new Date(e),m(),L(),v())}function et(t,e,n){const a=parseInt(t.dataset.index),r=e==="todo"?i.tasks:i.doneTasks,o=n==="todo"?i.tasks:i.doneTasks,d=r[a];if(d){const u=N(d,{});n==="done"?u.completedAt=Date.now():n==="todo"&&delete u.completedAt,r.splice(a,1),o.push(u),m(),D(),E()}}function nt(){if(!window.matchMedia("(max-width: 768px)").matches)return;const t=document.createElement("div");t.className="task-move-feedback",document.body.appendChild(t);let e=0,n=0;const a=50,r=500;function o(l,c){e=l.touches[0].clientX,n=Date.now(),c.classList.add("being-moved")}function d(l,c){const g=l.changedTouches[0].clientX,U=Date.now()-n,w=g-e;c.classList.remove("being-moved");const X=Math.abs(w)<a&&U<r,R=Math.abs(w)>a;if(X||R){const S=c.closest(".task-list").id==="todoList"?"todo":"done",I=S==="todo"?"done":"todo";t.textContent=`Moving to ${I==="todo"?"To-Do":"Done"}`,t.classList.add("visible"),s.listsContainer.classList.toggle("show-done"),setTimeout(()=>{et(c,S,I),t.classList.remove("visible")},300)}}function u(l,c){const k=l.touches[0].clientX-e;Math.abs(k)>a&&l.preventDefault()}[s.todoList,s.doneList].forEach(l=>{l.addEventListener("touchstart",c=>{const g=c.target.closest(".task-item");g&&o(c,g)},{passive:!1}),l.addEventListener("touchend",c=>{const g=c.target.closest(".task-item");g&&d(c,g)}),l.addEventListener("touchmove",c=>{c.target.closest(".task-item")&&u(c)},{passive:!1})})}function at(){s.addTaskBtn.addEventListener("click",()=>H()),s.saveTaskBtn.addEventListener("click",F),s.closeTaskBtn.addEventListener("click",y),s.settingsBtn.addEventListener("click",b),s.closeSettingsBtn.addEventListener("click",v),s.saveSettingsBtn.addEventListener("click",tt),s.nextList.addEventListener("click",()=>{s.listsContainer.classList.add("show-done")}),s.prevList.addEventListener("click",()=>{s.listsContainer.classList.remove("show-done")}),s.taskInput.addEventListener("keydown",V),s.taskDescription.addEventListener("keydown",a=>{a.key==="Escape"&&(a.preventDefault(),y())}),nt(),window.matchMedia("(max-width: 768px)").matches||(s.todoList.addEventListener("dragover",A),s.todoList.addEventListener("dragleave",B),s.todoList.addEventListener("drop",M),s.doneList.addEventListener("dragover",A),s.doneList.addEventListener("dragleave",B),s.doneList.addEventListener("drop",M)),s.goalTitle.addEventListener("click",b),window.addEventListener("click",a=>{a.target===s.taskModal&&y(),a.target===s.settingsModal&&v()});const t=document.getElementById("exportBtn");t&&t.addEventListener("click",ft);const e=document.getElementById("importBtn"),n=document.getElementById("importInput");e&&n&&(e.addEventListener("click",()=>n.click()),n.addEventListener("change",a=>{a.target.files.length>0&&mt(a.target.files[0])}))}function E(){if(!s.activityMatrix||!i.goalCreatedAt)return;const t=st();dt(t),ut(t)}function st(){const t=ot(),e=[];if(!i.goalCreatedAt||!i.targetDate)return e;const n=new Date;n.setHours(23,59,59,999);const a=new Date(i.targetDate);a.setHours(23,59,59,999);const r=a>n?a:n,o=new Date(t);for(;o<=r;){const d=f(o),u=it(d),l=f(new Date)===d,c=o>new Date;e.push({date:new Date(o),dateStr:d,count:u,level:c&&!l?-1:rt(u),dayOfWeek:o.getDay(),isToday:l,isFuture:c&&!l}),o.setDate(o.getDate()+1)}return e}function ot(){let t=i.goalCreatedAt?new Date(i.goalCreatedAt):new Date;const e=[...i.tasks,...i.doneTasks];if(e.length>0){const n=Math.min(...e.map(r=>r.createdAt||Date.now())),a=new Date(n);a<t&&(t=a)}return t.setHours(0,0,0,0),t}function f(t){const e=t.getFullYear(),n=String(t.getMonth()+1).padStart(2,"0"),a=String(t.getDate()).padStart(2,"0");return`${e}-${n}-${a}`}function it(t){return i.doneTasks.filter(e=>{if(!e.completedAt)return!1;const n=new Date(e.completedAt);return f(n)===t}).length}function rt(t){return t===0?0:t<=2?1:t<=4?2:t<=6?3:4}function dt(t){s.activityMatrix.innerHTML="",t.forEach(e=>{const n=document.createElement("div");let a="matrix-day";e.level===-1?a+=" matrix-day-future":a+=` matrix-day-${e.level}`,e.isToday&&(a+=" matrix-day-today"),n.className=a,n.dataset.date=e.dateStr,n.dataset.count=e.count,n.addEventListener("mouseenter",ct),n.addEventListener("mouseleave",lt),n.addEventListener("mousemove",P),s.activityMatrix.appendChild(n)})}function ct(t){const e=t.target,n=e.dataset.date,a=parseInt(e.dataset.count),o=f(new Date),d=n===o,u=new Date(n+"T00:00:00"),l=n>o,c=u.toLocaleDateString("en-US",{weekday:"short",month:"short",day:"numeric",year:"numeric"});let g;l&&!d?g=`No activity yet on ${c}`:d?g=`${a} ${a===1?"task":"tasks"} completed today`:g=`${a} ${a===1?"task":"tasks"} completed on ${c}`,s.activityTooltip.textContent=g,s.activityTooltip.classList.add("visible"),P(t)}function lt(){s.activityTooltip.classList.remove("visible")}function P(t){const e=s.activityTooltip.getBoundingClientRect();let n=t.clientY+20,a=t.clientX+10;a+e.width>window.innerWidth-8&&(a=t.clientX-e.width-10),n+e.height>window.innerHeight-8&&(n=t.clientY-e.height-10),s.activityTooltip.style.position="fixed",s.activityTooltip.style.top=`${n}px`,s.activityTooltip.style.left=`${a}px`}function ut(t){if(!s.activityStats)return;const n=t.filter(o=>!o.isFuture).filter(o=>o.count>0).length,a=t.reduce((o,d)=>o+d.count,0),r=gt(t);s.activityStats.textContent=`${a} tasks completed across ${n} days (${r} day streak)`}function gt(t){let e=0;const n=new Date;n.setHours(0,0,0,0);const a=f(n);let r=-1;for(let o=t.length-1;o>=0;o--)if(t[o].dateStr===a){r=o;break}if(r===-1){for(let o=t.length-1;o>=0;o--)if(!t[o].isFuture&&t[o].count>0)e++;else if(!t[o].isFuture)break;return e}for(let o=r;o>=0&&t[o].count>0;o--)e++;return e}function ft(){const t={version:"1.0",exportDate:new Date().toISOString(),data:{goal:i.goal,targetDate:i.targetDate?i.targetDate.toISOString():null,goalCreatedAt:i.goalCreatedAt?i.goalCreatedAt.toISOString():null,tasks:i.tasks,doneTasks:i.doneTasks}},e=new Blob([JSON.stringify(t,null,2)],{type:"application/json"}),n=URL.createObjectURL(e),a=document.createElement("a");a.href=n,a.download=`launch-ext-backup-${f(new Date)}.json`,document.body.appendChild(a),a.click(),document.body.removeChild(a),URL.revokeObjectURL(n)}async function mt(t){try{const e=await t.text(),n=JSON.parse(e);if(!n.version||!n.data)throw new Error("Invalid backup file format");i={goal:n.data.goal||"",targetDate:n.data.targetDate?new Date(n.data.targetDate):null,goalCreatedAt:n.data.goalCreatedAt?new Date(n.data.goalCreatedAt):null,tasks:Array.isArray(n.data.tasks)?n.data.tasks:[],doneTasks:Array.isArray(n.data.doneTasks)?n.data.doneTasks:[]},await m(),L(),v(),alert("Data imported successfully!")}catch(e){console.error("Import error:",e),alert("Error importing data. Please make sure the file is a valid backup file.")}}K();
